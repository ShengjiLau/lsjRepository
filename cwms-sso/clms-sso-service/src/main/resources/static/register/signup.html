<!DOCTYPE html>
<html lang="zh">
  <head>
    <meta charset="utf-8">
    <title>注册 | 大驼队cLMS协同物流管理系统</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no" />
    <link rel="stylesheet" href="/asset/style/style.css">
    <link rel="stylesheet" href="/asset/style/iconfont.css">
    <style media="screen">
      .register-btn{
        width: 300px;
        margin-left: 131px;
        height: 48px;
        color: #fff;
        font-size: 16px;
        line-height: 48px;
        text-align: center;
        display: inline-block;
        background: #108EE9;
        border-radius: 4px;
      }
    </style>
  </head>
  <body>
    <div class="nav-head">
      <nav>
        <div class="logo">
          <img src="/asset/image/logo_top.png" alt="">
          <span class="logo-title">用户注册</span>
        </div>
      </nav>
    </div>

    <div class="main-body">
      <form class=""  id="signup-form" >
        <div class="form-row require">
          <label for="name">姓名：</label>
          <div class="clms-input">
            <input type="text" name="name"  value="" id="name">
          </div>
        </div>
        <div class="form-row require">
          <label for="userPhoneNum">手机号：</label>
          <div class="clms-input">
            <span>+86</span>
            <input type="text" id="phone-num" name = "userPhoneNum"  value="" >
          </div>
        </div>
        <div class="form-row require">
          <label for="ecode">验证码：</label>
          <div class="clms-input sms-capcha-input">
            <input type="text" name="ecode" value="" id="code-input"  >
          </div>
          <div class="sms_capcha_btn">
            <button type="button"  id="get-codes-btn" class="inline-btn normal" >
              获取验证码
            </button>
          </div>
          <!-- <p class="tips">若短信验证码获取失败，<a href="javascript:">请获取语音验证码。</a></p> -->
        </div>
        <div class="form-row require">
          <label for="password">密码：</label>
          <div class="clms-input">
            <input type="password" name="password" id="inputPassword"  value="" >
          </div>
        </div>
        <div class="form-row require">
          <label for="password1">确认密码：</label>
          <div class="clms-input">
            <input type="password" name="password1"  id="inputPasswordConfirm"  value="" >
          </div>
        </div>
        <div class="form-row">
          <label for="introducer">推荐人手机号：</label>
          <div class="clms-input">
            <input type="text"  id="introducer_id" name="introducer" value="" >
          </div>
        </div>
        <div class="form-row" style="margin-top:32px;">
            <button class="register-btn" type="submit">
              注册
            </button>
          </div>
      </form>
    </div>
    <script src="https://cdn.bootcss.com/jquery/3.2.1/jquery.min.js"></script>
    <script src="https://cdn.bootcss.com/jquery-validate/1.17.0/jquery.validate.min.js"></script>
    <script src="https://cdn.bootcss.com/jquery-validate/1.17.0/localization/messages_zh.min.js"></script>
    <script type="text/javascript">
      var countdown=6;
      function settime(obj) {
          obj = $("#get-codes-btn");
          if (countdown == 0) {
              obj.removeAttribute("disabled");
              obj.innerHTML="获取验证码";
              countdown = 6;
              return;
          } else {
              $("#get-codes-btn").attr("disabled",true)
              obj.innerHTML="重新发送(" + countdown + ")";
              countdown--;
          }

      // 发送短信后回调
      setTimeout(function() {
          settime(obj) }
          ,1000)
      }



      // /**
      //  * 注册提交
      //  */
      // $("#signup-form").submit(function (event) {
      //
      // });

      /**
       * 获取短信验证码
       */
      $('#get-codes-btn').click(function () {
          if ($("#phone-num").val().length == 11) {
              var form = document.getElementById("signup-form");
              var fd = new FormData(form);
              $.ajax({
                  url : '/auth/register/vSmsCode',
                  type : 'POST',
                  data : fd,
                  async : false,
                  cache : false,
                  contentType : false,// 告诉jQuery不要去设置Content-Type请求头
                  processData : false,// 告诉jQuery不要去处理发送的数据
                  success : function(data) {
                      console.log(data);
                      if (!data.flag && data.msg!="") {
                          alert(data.msg);
                      } else {
                          settime($(this));
                      }
                  },
                  error : function(data) {
                      console.log(data);
                  }
              });
          }else {
              alert("请填写正确手机号");
          }
      });


      $.validator.setDefaults({
        submitHandler: function() {
            var form = document.getElementById("signup-form");
            var fd = new FormData(form);
            event.preventDefault();

            $.ajax({
                url : '/auth/register/save',
                type : 'POST',
                data : fd,
                async : false,
                cache : false,
                contentType : false,// 告诉jQuery不要去设置Content-Type请求头
                processData : false,// 告诉jQuery不要去处理发送的数据
                success : function(data) {
                    if (!data.flag) {
                        alert(data.msg);
                    } else {
                        window.location.href="../auth/register/regSuccess";
                    }
                    console.log(data);
                },
                error : function(data) {
                    console.log(data);
                }
            });
        }
      });
      $.validator.addMethod("checkPhone",function(value,element,params){
         var checkPhone = /^1[3|5|4|8|7]{1}[0-9]{9}$/
         return this.optional(element)||(checkPhone.test(value));
       },"*请输入正确的手机号码！");

      $().ready(function() {
        $("#signup-form").validate({
          rules:{     //配置验证规则，key就是被验证的dom对象，value就是调用验证的方法(也是json格式)
              name:{
                  required:true,  //必填。如果验证方法不需要参数，则配置为true
                  rangelength:[2,6],
              },
              userPhoneNum:{
                    required:true,  //必填。如果验证方法不需要参数，则配置为true
                    checkPhone:true,
                },
                password:{
                    required:true,
                    rangelength:[6,12],
                },
              password1:{
                    required:true,
                    equalTo:"#inputPassword",
                },
              ecode:{
                    required:true,
                    rangelength:[4,4],
                }
            },
            messages: {
                userPhoneNum: {
                  required: "请输入手机号",
                  checkPhone: "请输入正确手机号",
              },
              password:{
                required: "请输入密码",
                rangelength: "请输入正确密码",
              },
                password1:{
                required: "请输入密码",
                equalTo: "输入的密码不一致",
              },
                ecode:{
                required: "请输入验证码",
                rangelength: "请输入4位验证码",
              }
            }
        });
      });
      </script>
  </body>
</html>
