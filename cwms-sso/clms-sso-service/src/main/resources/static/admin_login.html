<!DOCTYPE html>
<html lang="zh">
  <head>
    <meta charset="utf-8">
    <title>登录 | 大驼队cLMS协同物流管理后台系统</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no" />
    <link rel="stylesheet" href="/asset/style/signin.css">
    <link rel="stylesheet" href="/asset/style/iconfont.css">
    <link rel="shortcut icon" href="/favicon.ico" >
  </head>
  <body>
    <div class="page">
      <div class="signin-box">
        <div class="logo-box-m">
        </div>
      <div class="signin-form">
        <form id="signin-form" class="" action="/account/login" method="post">
          <div class="form-row">
            <label for="username">手机号：</label>
            <div class="clms-input">
              <span>+86</span>
              <input type="text" name="username" id="username"  value="" placeholder="请输入手机号">
            </div>
          </div>
          <div class="form-row">
            <label for="password">密码：</label>
            <div class="clms-input">
              <input  type="password" name="password" id="password" value="" placeholder="请输入密码">
            </div>
          </div>
          <div class="form-row">
            <label for="captchacode">验证码：</label>
            <div class="clms-input capcha_input">
              <input type="text" name="captchacode" id="captchacode" value="" placeholder="请输入验证码">
            </div>
            <div class="capcha_img">
              <img style="height: 38px" id="captchaimg" src="/auth/getcaptcha" alt="./public/vc.png" onclick="refreshCaptcha()"></a></div>
          </div>
          <div class="form-row login-btn-row" style="margin-top:32px;">
            <button type="submit" class="login-btn">
              登录
            </button>
          </div>
        </form>
      </div>
    </div>
    </div>
    </div>
    <script src="https://cdn.bootcss.com/jquery/3.2.1/jquery.min.js"></script>
    <script src="https://cdn.bootcss.com/jquery-validate/1.17.0/jquery.validate.min.js"></script>
    <script src="https://cdn.bootcss.com/jquery-validate/1.17.0/localization/messages_zh.min.js"></script>
    <script type="text/javascript">
        $().ready(function() {
            $("#signin-form").validate({
                rules:{     //配置验证规则，key就是被验证的dom对象，value就是调用验证的方法(也是json格式)
                    username:{
                        required:true,  //必填。如果验证方法不需要参数，则配置为true
                        rangelength:[11,11],
                        checkPhone:true
                    },
                    password:{
                        required:true,
                        rangelength:[6,12],
                    },
                    captchacode:{
                        required:true,
                        rangelength:[3,5],
                    }
                },
                messages: {
                    username: {
                        required: "请输入手机号",
                        rangelength: "请输入11位手机号码",
                        checkPhone:'请输入正确的手机号码格式'
                    },
                    password:{
                        required: "请输入密码",
                        rangelength: "请输入6-12位密码",
                    },
                    captchacode:{
                        required: "请输入验证码",
                        rangelength: "请输入4位验证码",
                    }
                }
            });
        });

        //验证码
        var refreshCaptcha = function(){
            document.getElementById("captchaimg").src="/auth/getcaptcha?random=" + Math.random();
            return false;
        }


        //注册逻辑
        var register = function () {
            var hStr = window.location.href.split(":")[0];
            window.location.href = hStr+"://"+window.location.host+"/auth/register";
        }


        $.validator.setDefaults({
        submitHandler: function() {
            var form = document.getElementById("signin-form");
            var fd = new FormData(form);
            $.ajax({
                processData: false,
                contentType: false,
                type: 'POST',
                url: '/account/adminlogin',
                data: fd,
                success: function (data) {
                    var data = JSON.parse(data);
                    if (data.code == 0) {
                        alert("登录成功");

                    }else{
                        alert(data.message);
                        $("#captchacode").val("");
                        refreshCaptcha();
                    }
                },
                error: function (data) {
                    var result = JSON.parse(data);
                    alert(result.message);
                },
            });

        }
      });
        $.validator.addMethod("checkPhone",function(value,element,params){
            var checkPhone = /^1[3|5|4|8|7|9|6]{1}[0-9]{9}$/
            return this.optional(element)||(checkPhone.test(value));
        },"请输入正确的手机号码！");
      </script>

  </body>
</html>
