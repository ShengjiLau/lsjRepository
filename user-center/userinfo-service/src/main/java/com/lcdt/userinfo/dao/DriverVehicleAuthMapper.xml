<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.lcdt.userinfo.dao.DriverVehicleAuthMapper">
  <resultMap id="BaseResultMap" type="com.lcdt.userinfo.model.DriverVehicleAuth">
    <id column="auth_id" jdbcType="BIGINT" property="authId" />
    <result column="driver_id" jdbcType="BIGINT" property="driverId" />
    <result column="vehicle_num" jdbcType="VARCHAR" property="vehicleNum" />
    <result column="vehicle_trailers_num" jdbcType="VARCHAR" property="vehicleTrailersNum" />
    <result column="vehicle_type" jdbcType="VARCHAR" property="vehicleType" />
    <result column="vehicle_load" jdbcType="DECIMAL" property="vehicleLoad" />
    <result column="vehicle_length" jdbcType="DECIMAL" property="vehicleLength" />
    <result column="auth_status" jdbcType="VARCHAR" property="authStatus" />
    <result column="auth_name" jdbcType="VARCHAR" property="authName" />
    <result column="auth_time" jdbcType="TIMESTAMP" property="authTime" />
    <result column="vehicle_photo" jdbcType="VARCHAR" property="vehiclePhoto" />
    <result column="vehicle_tail_photo" jdbcType="VARCHAR" property="vehicleTailPhoto" />
    <result column="vehicle_trailers_photo" jdbcType="VARCHAR" property="vehicleTrailersPhoto" />
    <result column="vehicle_driving_photo" jdbcType="VARCHAR" property="vehicleDrivingPhoto" />
    <result column="vehicle_operating_photo" jdbcType="VARCHAR" property="vehicleOperatingPhoto" />
    <result column="vehicle_trailers_operating_photo" jdbcType="VARCHAR" property="vehicleTrailersOperatingPhoto" />
    <result column="is_default" jdbcType="BIT" property="isDefault" />
    <result column="create_name" jdbcType="VARCHAR" property="createName" />
    <result column="create_date" jdbcType="TIMESTAMP" property="createDate" />
    <result column="create_id" jdbcType="BIGINT" property="createId" />
    <result column="update_id" jdbcType="BIGINT" property="updateId" />
    <result column="update_name" jdbcType="VARCHAR" property="updateName" />
    <result column="update_date" jdbcType="TIMESTAMP" property="updateDate" />
    <result column="is_deleted" jdbcType="BIT" property="isDeleted" />
    <result column="auth_remark" jdbcType="VARCHAR" property="authRemark" />
    <association property="driver" resultMap="com.lcdt.userinfo.dao.DriverMapper.BaseResultMap"
    ></association>

  </resultMap>
  <delete id="deleteByPrimaryKey" parameterType="java.lang.Long">
    delete from t_driver_vehicle_auth
    where auth_id = #{authId,jdbcType=BIGINT}
  </delete>
  <insert id="insert" parameterType="com.lcdt.userinfo.model.DriverVehicleAuth">
    <selectKey keyProperty="authId" order="AFTER" resultType="java.lang.Long">
      SELECT LAST_INSERT_ID()
    </selectKey>
    insert into t_driver_vehicle_auth (driver_id, vehicle_num, vehicle_trailers_num, 
      vehicle_type, vehicle_load, vehicle_length, 
      auth_status, vehicle_photo, vehicle_tail_photo,vehicle_trailers_photo,
      vehicle_driving_photo, vehicle_operating_photo, 
      vehicle_trailers_operating_photo, is_default, create_name, 
      create_date, create_id, update_id, 
      update_name, update_date, is_deleted,auth_remark
      )
    values (#{driverId,jdbcType=BIGINT}, #{vehicleNum,jdbcType=VARCHAR}, #{vehicleTrailersNum,jdbcType=VARCHAR}, 
      #{vehicleType,jdbcType=VARCHAR}, #{vehicleLoad,jdbcType=DECIMAL}, #{vehicleLength,jdbcType=DECIMAL}, 
      #{authStatus,jdbcType=VARCHAR}, #{vehiclePhoto,jdbcType=VARCHAR}, #{vehicleTailPhoto,jdbcType=VARCHAR}, #{vehicleTrailersPhoto,jdbcType=VARCHAR},
      #{vehicleDrivingPhoto,jdbcType=VARCHAR}, #{vehicleOperatingPhoto,jdbcType=VARCHAR}, 
      #{vehicleTrailersOperatingPhoto,jdbcType=VARCHAR}, #{isDefault,jdbcType=BIT}, #{createName,jdbcType=VARCHAR}, 
      #{createDate,jdbcType=TIMESTAMP}, #{createId,jdbcType=BIGINT}, #{updateId,jdbcType=BIGINT}, 
      #{updateName,jdbcType=VARCHAR}, #{updateDate,jdbcType=TIMESTAMP}, 0,#{authRemark,jdbcType=VARCHAR}
      )
  </insert>
  <update id="updateByPrimaryKey" parameterType="com.lcdt.userinfo.model.DriverVehicleAuth">
    update t_driver_vehicle_auth
    set driver_id = #{driverId,jdbcType=BIGINT},
      vehicle_num = #{vehicleNum,jdbcType=VARCHAR},
      vehicle_trailers_num = #{vehicleTrailersNum,jdbcType=VARCHAR},
      vehicle_type = #{vehicleType,jdbcType=VARCHAR},
      vehicle_load = #{vehicleLoad,jdbcType=DECIMAL},
      vehicle_length = #{vehicleLength,jdbcType=DECIMAL},
      auth_status = #{authStatus,jdbcType=VARCHAR},
      vehicle_photo = #{vehiclePhoto,jdbcType=VARCHAR},
      vehicle_tail_photo = #{vehicleTailPhoto,jdbcType=VARCHAR},
      vehicle_trailers_photo = #{vehicleTrailersPhoto,jdbcType=VARCHAR},
      vehicle_driving_photo = #{vehicleDrivingPhoto,jdbcType=VARCHAR},
      vehicle_operating_photo = #{vehicleOperatingPhoto,jdbcType=VARCHAR},
      vehicle_trailers_operating_photo = #{vehicleTrailersOperatingPhoto,jdbcType=VARCHAR},
      is_default = #{isDefault,jdbcType=BIT},
      create_name = #{createName,jdbcType=VARCHAR},
      create_date = #{createDate,jdbcType=TIMESTAMP},
      create_id = #{createId,jdbcType=BIGINT},
      update_id = #{updateId,jdbcType=BIGINT},
      update_name = #{updateName,jdbcType=VARCHAR},
      update_date = #{updateDate,jdbcType=TIMESTAMP},
      is_deleted = #{isDeleted,jdbcType=BIT},
      auth_remark = #{authRemark,jdbcType=VARCHAR}
    where auth_id = #{authId,jdbcType=BIGINT}
  </update>
  <select id="selectByPrimaryKey" parameterType="java.lang.Long" resultMap="BaseResultMap">
    select auth_id, driver_id, vehicle_num, vehicle_trailers_num, vehicle_type, vehicle_load, 
    vehicle_length, auth_status, vehicle_photo, vehicle_tail_photo, vehicle_trailers_photo, vehicle_driving_photo,
    vehicle_operating_photo, vehicle_trailers_operating_photo, is_default, create_name, 
    create_date, create_id, update_id, update_name, update_date, is_deleted,auth_remark
    from t_driver_vehicle_auth
    where auth_id = #{authId,jdbcType=BIGINT}
  </select>
  <select id="selectAll" resultMap="BaseResultMap">
    select auth_id, driver_id, vehicle_num, vehicle_trailers_num, vehicle_type, vehicle_load, 
    vehicle_length, auth_status, vehicle_photo,vehicle_tail_photo, vehicle_trailers_photo, vehicle_driving_photo,
    vehicle_operating_photo, vehicle_trailers_operating_photo, is_default, create_name, 
    create_date, create_id, update_id, update_name, update_date, is_deleted,auth_remark
    from t_driver_vehicle_auth
  </select>

  <select id="selectByDriverId" resultMap="BaseResultMap">

     select auth_id, driver_id, vehicle_num, vehicle_trailers_num, vehicle_type, vehicle_load,
    vehicle_length, auth_status, vehicle_photo,vehicle_tail_photo, vehicle_trailers_photo, vehicle_driving_photo,
    vehicle_operating_photo, vehicle_trailers_operating_photo, is_default, create_name,
    create_date, create_id, update_id, update_name, update_date, is_deleted,auth_remark
    from t_driver_vehicle_auth
    where  driver_id = #{driverId,jdbcType=BIGINT}
    AND (is_deleted is null
	or is_deleted != 1)
	order by is_default desc
  </select>

  <select id="selectVehicleNumExist" parameterType="com.lcdt.userinfo.model.DriverVehicleAuth" resultMap="BaseResultMap">
    select auth_id, driver_id, vehicle_num, vehicle_trailers_num, vehicle_type, vehicle_load,
    vehicle_length, auth_status, vehicle_photo,vehicle_tail_photo, vehicle_trailers_photo, vehicle_driving_photo,
    vehicle_operating_photo, vehicle_trailers_operating_photo, is_default, create_name,
    create_date, create_id, update_id, update_name, update_date, is_deleted,auth_remark
    from t_driver_vehicle_auth
    where  driver_id = #{driverId,jdbcType=BIGINT} and vehicle_num = #{vehicleNum,jdbcType=VARCHAR} and is_deleted=0
  </select>
<select id="updateDefault" parameterType="java.lang.Long" >

update t_driver_vehicle_auth set is_default=0 where driver_id =#{driverId,jdbcType=BIGINT}
</select>


  <select id="selectByDriverQueryDto" resultMap="BaseResultMap" parameterType="com.lcdt.userinfo.web.controller.api.admin.dto.DriverQueryDto">
    SELECT * from t_driver_vehicle_auth a left join t_driver d on a.driver_id = d.user_id
    <where>
      <if test="driverName != null and driverName != ''">
        and d.driver_name like concat(concat('%',#{driverName}),'%')
      </if>

      <if test="driverPhone != null and driverPhone != ''">
        and d.driver_phone like concat(concat('%',#{driverPhone}),'%')
      </if>

      <if test="vehicleNum != null and vehicleNum != ''">
        and d.vehicle_num like concat(concat('%',#{vehicleNum}),'%')
      </if>

      <if test="authStatus != null and authStatus != ''">
       and  a.auth_status = #{authStatus}
      </if>
      <if test="createDateSince != null ">
        and a.create_date  &gt;= #{createDateSince}
      </if>
      <if test="createDateUntil != null ">
        and a.create_date  &lt;=  #{createDateUntil}
      </if>

    </where>
  </select>

  <select id="selectByDriverIds" resultType="java.util.Map">
    select driver_id,count(*) vehicle_num
    from t_driver_vehicle_auth
    where driver_id in
    <foreach collection="list" item="item" index="index" open="(" close=")" separator=",">
      #{item}
    </foreach>
    GROUP BY driver_id
  </select>
  <update id="updateAuthStatus" parameterType="com.lcdt.userinfo.web.controller.api.admin.dto.VehicleAuthDto">
    update t_driver_vehicle_auth
    set auth_status = #{authStatus,jdbcType=VARCHAR},
      auth_name = #{authName,jdbcType=VARCHAR},
      auth_time = #{authTime,jdbcType=TIMESTAMP},
      auth_remark = #{authRemark,jdbcType=VARCHAR}
    where auth_id = #{authId,jdbcType=BIGINT}
  </update>
</mapper>