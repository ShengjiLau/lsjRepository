<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.lcdt.userinfo.dao.UserGroupRelationMapper">
  <resultMap id="BaseResultMap" type="com.lcdt.userinfo.model.UserGroupRelation">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    <id column="relation_id" jdbcType="BIGINT" property="relationId" />
    <result column="user_id" jdbcType="BIGINT" property="userId" />
    <result column="company_id" jdbcType="BIGINT" property="companyId" />
    <result column="group_id" jdbcType="BIGINT" property="groupId" />
  </resultMap>

  <resultMap id="GroupResult" type="com.lcdt.userinfo.model.Group">
    <id column="group_id" jdbcType="BIGINT" property="groupId" />
    <result column="group_name" jdbcType="VARCHAR" property="groupName" />
    <result column="company_id" jdbcType="BIGINT" property="companyId" />
    <result column="is_valid" jdbcType="BIT" property="isValid" />
    <result column="group_remark" jdbcType="VARCHAR" property="groupRemark" />
  </resultMap>

  <delete id="deleteByPrimaryKey" parameterType="java.lang.Long">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    delete from t_uc_user_group
    where relation_id = #{relationId,jdbcType=BIGINT}
  </delete>
  <insert id="insert" parameterType="com.lcdt.userinfo.model.UserGroupRelation">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    <selectKey keyProperty="relationId" order="AFTER" resultType="java.lang.Long">
      SELECT LAST_INSERT_ID()
    </selectKey>
    insert into t_uc_user_group (user_id, company_id, group_id,group_create_date)
    values (#{userId,jdbcType=BIGINT}, #{companyId,jdbcType=BIGINT}, #{groupId,jdbcType=BIGINT},#{groupCreateDate,jdbcType=TIMESTAMP}
      )
  </insert>
  <update id="updateByPrimaryKey" parameterType="com.lcdt.userinfo.model.UserGroupRelation">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    update t_uc_user_group
    set user_id = #{userId,jdbcType=BIGINT},
      company_id = #{companyId,jdbcType=BIGINT},
      group_id = #{groupId,jdbcType=BIGINT}
    where relation_id = #{relationId,jdbcType=BIGINT}
  </update>
  <select id="selectByPrimaryKey" parameterType="java.lang.Long" resultMap="BaseResultMap">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    select relation_id, user_id, company_id, group_id
    from t_uc_user_group
    where relation_id = #{relationId,jdbcType=BIGINT}
  </select>
  <select id="selectAll" resultMap="BaseResultMap">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    select relation_id, user_id, company_id, group_id
    from t_uc_user_group
  </select>

  <select id="selectByGroupId" resultMap="BaseResultMap">

  select relation_id, user_id, company_id, group_id
    from t_uc_user_group
    WHERE group_id = #{groupId,jdbcType=BIGINT}
  </select>

  <select id="selectByUserCompany" resultMap="com.lcdt.userinfo.dao.GroupMapper.BaseResultMap">
    select g.*  from t_uc_user_group ug
    left join t_uc_group g on g.group_id = ug.group_id
        WHERE ug.user_id = #{userId,jdbcType=BIGINT} and ug.company_id = #{companyId,jdbcType=BIGINT}
  </select>

  <delete id="deleteNotInGroups" >

    DELETE FROM t_uc_user_group
    where user_id = #{userId}
    and company_id = #{companyId}
    <if test="groups != null">
      and group_id not in
      <foreach item="item" index="index" collection="groups"
               open="(" separator="," close=")"
      >
        #{item}
      </foreach>
    </if>

  </delete>

  <insert id="insertGroups">
    INSERT INTO t_uc_user_group
    (group_id, user_id,company_id)
    values
    <foreach collection="groups" item="item"
             separator="," close=";">
      (#{item,jdbcType=BIGINT}, #{userId,jdbcType=BIGINT},#{companyId,jdbcType=BIGINT})
    </foreach>
  </insert>


  <select id="selectByUserIdAndCmpId" resultMap="BaseResultMap">
    select relation_id, user_id, company_id, group_id
    from t_uc_user_group
    WHERE user_id = #{userId,jdbcType=BIGINT} and group_id = #{groupId,jdbcType=BIGINT} and company_id = #{companyId,jdbcType=BIGINT}
  </select>


  <delete id="deleteByUserGroupRelation">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    delete from t_uc_user_group
    WHERE user_id = #{userId,jdbcType=BIGINT} and group_id = #{groupId,jdbcType=BIGINT} and company_id = #{companyId,jdbcType=BIGINT}
  </delete>

  <delete id="removeUserGroupRelation">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    delete from t_uc_user_group
    WHERE user_id = #{userId,jdbcType=BIGINT} and company_id = #{companyId,jdbcType=BIGINT}
  </delete>

</mapper>