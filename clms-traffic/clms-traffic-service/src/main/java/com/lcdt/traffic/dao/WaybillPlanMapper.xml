<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.lcdt.traffic.dao.WaybillPlanMapper">

  <resultMap id="BaseResultMap" type="com.lcdt.traffic.model.WaybillPlan">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue Dec 12 09:56:12 CST 2017.
    -->
    <id column="waybill_plan_id" jdbcType="BIGINT" property="waybillPlanId" />
    <result column="plan_code" jdbcType="VARCHAR" property="planCode" />
    <result column="serial_code" jdbcType="VARCHAR" property="serialCode" />
    <result column="group_id" jdbcType="BIGINT" property="groupId" />
    <result column="group_name" jdbcType="VARCHAR" property="groupName" />
    <result column="carrier_collection_ids" jdbcType="VARCHAR" property="carrierCollectionIds" />
    <result column="carrier_collection_names" jdbcType="VARCHAR" property="carrierCollectionNames" />
    <result column="carrier_driver_ids" jdbcType="VARCHAR" property="carrierDriverIds" />
    <result column="carrier_driver_names" jdbcType="VARCHAR" property="carrierDriverNames" />
    <result column="carrier_ids" jdbcType="VARCHAR" property="carrierIds" />
    <result column="carrier_names" jdbcType="VARCHAR" property="carrierNames" />
    <result column="carrier_phone" jdbcType="VARCHAR" property="carrierPhone" />
    <result column="carrier_vehicle" jdbcType="VARCHAR" property="carrierVehicle" />
    <result column="plan_source" jdbcType="VARCHAR" property="planSource" />
    <result column="plan_status" jdbcType="VARCHAR" property="planStatus" />
    <result column="send_card_status" jdbcType="SMALLINT" property="sendCardStatus" />
    <result column="send_order_type" jdbcType="SMALLINT" property="sendOrderType" />
    <result column="carrier_type" jdbcType="SMALLINT" property="carrierType" />
    <result column="biding_start" jdbcType="TIMESTAMP" property="bidingStart" />
    <result column="biding_end" jdbcType="TIMESTAMP" property="bidingEnd" />
    <result column="customer_id" jdbcType="BIGINT" property="customerId" />
    <result column="customer_name" jdbcType="VARCHAR" property="customerName" />
    <result column="customer_phone" jdbcType="VARCHAR" property="customerPhone" />
    <result column="sales_order" jdbcType="VARCHAR" property="salesOrder" />
    <result column="cust_contact_man" jdbcType="VARCHAR" property="custContactMan" />
    <result column="send_wh_id" jdbcType="BIGINT" property="sendWhId" />
    <result column="send_wh_name" jdbcType="VARCHAR" property="sendWhName" />
    <result column="send_man" jdbcType="VARCHAR" property="sendMan" />
    <result column="send_phone" jdbcType="VARCHAR" property="sendPhone" />
    <result column="send_province" jdbcType="VARCHAR" property="sendProvince" />
    <result column="send_city" jdbcType="VARCHAR" property="sendCity" />
    <result column="send_county" jdbcType="VARCHAR" property="sendCounty" />
    <result column="send_address" jdbcType="VARCHAR" property="sendAddress" />
    <result column="receive_man" jdbcType="VARCHAR" property="receiveMan" />
    <result column="receive_phone" jdbcType="VARCHAR" property="receivePhone" />
    <result column="receive_province" jdbcType="VARCHAR" property="receiveProvince" />
    <result column="receive_city" jdbcType="VARCHAR" property="receiveCity" />
    <result column="receive_county" jdbcType="VARCHAR" property="receiveCounty" />
    <result column="receive_address" jdbcType="VARCHAR" property="receiveAddress" />
    <result column="transport_way" jdbcType="SMALLINT" property="transportWay" />
    <result column="goods_type" jdbcType="VARCHAR" property="goodsType" />
    <result column="start_date" jdbcType="TIMESTAMP" property="startDate" />
    <result column="arrive_date" jdbcType="TIMESTAMP" property="arriveDate" />
    <result column="is_receipt" jdbcType="SMALLINT" property="isReceipt" />
    <result column="is_urgent" jdbcType="SMALLINT" property="isUrgent" />
    <result column="distribution_way" jdbcType="VARCHAR" property="distributionWay" />
    <result column="attachment1" jdbcType="VARCHAR" property="attachment1" />
    <result column="attachment1_name" jdbcType="VARCHAR" property="attachment1Name" />
    <result column="attachment2" jdbcType="VARCHAR" property="attachment2" />
    <result column="attachment2_name" jdbcType="VARCHAR" property="attachment2Name" />
    <result column="attachment3" jdbcType="VARCHAR" property="attachment3" />
    <result column="attachment3_name" jdbcType="VARCHAR" property="attachment3Name" />
    <result column="attachment4" jdbcType="VARCHAR" property="attachment4" />
    <result column="attachment4_name" jdbcType="VARCHAR" property="attachment4Name" />
    <result column="attachment5" jdbcType="VARCHAR" property="attachment5" />
    <result column="attachment5_name" jdbcType="VARCHAR" property="attachment5Name" />
    <result column="is_approval" jdbcType="SMALLINT" property="isApproval" />
    <result column="plan_remark" jdbcType="VARCHAR" property="planRemark" />
    <result column="create_id" jdbcType="BIGINT" property="createId" />
    <result column="create_name" jdbcType="VARCHAR" property="createName" />
    <result column="create_date" jdbcType="TIMESTAMP" property="createDate" />
    <result column="update_id" jdbcType="BIGINT" property="updateId" />
    <result column="update_name" jdbcType="VARCHAR" property="updateName" />
    <result column="update_time" jdbcType="TIMESTAMP" property="updateTime" />
    <result column="is_deleted" jdbcType="SMALLINT" property="isDeleted" />
    <result column="carrier_company_id" jdbcType="BIGINT" property="carrierCompanyId" />
    <result column="carrier_company_name" jdbcType="VARCHAR" property="carrierCompanyName" />
    <result column="company_id" jdbcType="BIGINT" property="companyId" />
    <result column="plan_days" jdbcType="INTEGER" property="planDays" />
    <result column="pubdate" jdbcType="TIMESTAMP" property="pubdate" />
    <result column="finish_date" jdbcType="TIMESTAMP" property="finishDate" />
    <result column="cancel_date" jdbcType="TIMESTAMP" property="cancelDate" />
    <result column="cancel_man" jdbcType="VARCHAR" property="cancelMan" />
    <result column="cancel_remark" jdbcType="VARCHAR" property="cancelRemark" />

    <!--计划详细-->
    <collection property="planDetailList" column="{waybillPlanId=waybill_plan_id,companyId=company_id,isDeleted=is_deleted}"
                ofType="com.lcdt.traffic.model.PlanDetail" javaType="ArrayList"
                select="com.lcdt.traffic.dao.PlanDetailMapper.selectByWaybillPlanId" />
    <!--派单记录-->
    <collection property="splitGoodsList" column="{waybillPlanId=waybill_plan_id,companyId=company_id,isDeleted=is_deleted}"
                ofType="com.lcdt.traffic.model.SplitGoods" javaType="ArrayList"
                select="com.lcdt.traffic.dao.SplitGoodsMapper.selectByWaybillPlanId" />
    <!--运单列表-->
    <collection property="waybillList" column="{waybillPlanId=waybill_plan_id,companyId=company_id}"
                ofType="com.lcdt.traffic.model.WaybillDao" javaType="ArrayList"
                select="com.lcdt.traffic.dao.WaybillMapper.selectWaybillByPlanId" />

    <!--抢单报价-->
    <collection property="snatchGoodsList" column="{waybillPlanId=waybill_plan_id,isDeleted=is_deleted}"
                  ofType="com.lcdt.traffic.model.SnatchGoods" javaType="ArrayList"
                  select="com.lcdt.traffic.dao.SnatchGoodsMapper.selectByWaybillPlanId" />

    <!--运输方式列表-->
    <collection property="transportWayItemsList" column="{waybillPlanId=waybill_plan_id}"
                ofType="com.lcdt.traffic.model.TransportWayItems" javaType="ArrayList"
                select="com.lcdt.traffic.dao.TransportWayItemsMapper.selectByWaybillPlanId" />

  </resultMap>

  <!---->
  <resultMap id="CustomerPlanBaseResultMap" type="com.lcdt.traffic.dto.CustomerPlanDto">
    <id column="waybill_plan_id" jdbcType="BIGINT" property="waybillPlanId" />
    <result column="plan_code" jdbcType="VARCHAR" property="planCode" />
    <result column="serial_code" jdbcType="VARCHAR" property="serialCode" />
    <result column="receive_province" jdbcType="VARCHAR" property="receiveProvince" />
    <result column="receive_city" jdbcType="VARCHAR" property="receiveCity" />
    <result column="receive_county" jdbcType="VARCHAR" property="receiveCounty" />
    <result column="receive_address" jdbcType="VARCHAR" property="receiveAddress" />
    <result column="is_deleted" jdbcType="SMALLINT" property="isDeleted" />
    <result column="company_id" jdbcType="BIGINT" property="companyId" />
    <result column="split_goods_id" jdbcType="BIGINT" property="splitGoodsId" />
   <!--计划列表-->
    <collection property="planDetailList" column="{waybillPlanId=waybill_plan_id,companyId=company_id,isDeleted=is_deleted}"
                ofType="com.lcdt.traffic.model.PlanDetail" javaType="ArrayList"
                select="com.lcdt.traffic.dao.PlanDetailMapper.selectByWaybillPlanId" />
    <!--运单列表-->
    <collection property="waybillList" column="{waybillPlanId=waybill_plan_id,companyId=company_id}"
                ofType="com.lcdt.traffic.model.Waybill" javaType="ArrayList"
                select="com.lcdt.traffic.dao.WaybillMapper.selectWaybillByPlanId" />
    <!--抢单报价-->
    <collection property="snatchGoodsList" column="{waybillPlanId=waybill_plan_id,isDeleted=is_deleted}"
                ofType="com.lcdt.traffic.model.SnatchGoods" javaType="ArrayList"
                select="com.lcdt.traffic.dao.SnatchGoodsMapper.selectByWaybillPlanId" />

      <!--派单记录-->
      <collection property="splitGoodsList" column="{waybillPlanId=waybill_plan_id,companyId=company_id,isDeleted=is_deleted}"
                  ofType="com.lcdt.traffic.model.SplitGoods" javaType="ArrayList"
                  select="com.lcdt.traffic.dao.SplitGoodsMapper.selectByWaybillPlanId" />
  </resultMap>


  <delete id="deleteByPrimaryKey" parameterType="java.lang.Long">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue Dec 12 09:56:12 CST 2017.
    -->
    delete from t_waybill_plan
    where waybill_plan_id = #{waybillPlanId,jdbcType=BIGINT}
  </delete>
  <insert id="insert" parameterType="com.lcdt.traffic.model.WaybillPlan">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue Dec 12 09:56:12 CST 2017.
    -->
    <selectKey keyProperty="waybillPlanId" order="AFTER" resultType="java.lang.Long">
      SELECT LAST_INSERT_ID()
    </selectKey>
    insert into t_waybill_plan (plan_code, serial_code, group_id, 
      group_name, plan_source, plan_status, 
      send_card_status, send_order_type, carrier_type, carrier_collection_ids,
      carrier_collection_names,carrier_driver_ids,carrier_driver_names,carrier_ids,
      carrier_names,carrier_phone, carrier_vehicle,
      biding_start, biding_end, customer_id,
      customer_name, customer_phone, sales_order, 
      cust_contact_man, send_wh_id, send_wh_name, 
      send_man, send_phone, send_province, 
      send_city, send_county, send_address, 
      receive_man, receive_phone, receive_province, 
      receive_city, receive_county, receive_address, 
      transport_way, goods_type, start_date, 
      arrive_date, is_receipt, is_urgent, 
      distribution_way, attachment1, attachment1_name, 
      attachment2, attachment2_name, attachment3, 
      attachment3_name, attachment4, attachment4_name, 
      attachment5, attachment5_name, is_approval, 
      plan_remark, create_id, create_name, 
      create_date, update_id, update_name, 
      update_time, is_deleted, carrier_company_id, 
      company_id, plan_days, pubdate, 
      finish_date, cancel_date, cancel_man, 
      cancel_remark,carrier_company_name)
    values (#{planCode,jdbcType=VARCHAR}, F_PLAN_SERIAL_CODE(#{transportWay,jdbcType=SMALLINT}), #{groupId,jdbcType=BIGINT},
      #{groupName,jdbcType=VARCHAR}, #{planSource,jdbcType=VARCHAR}, #{planStatus,jdbcType=VARCHAR}, 
      #{sendCardStatus,jdbcType=SMALLINT}, #{sendOrderType,jdbcType=SMALLINT}, #{carrierType,jdbcType=SMALLINT},
      #{carrierCollectionIds,jdbcType=VARCHAR},#{carrierCollectionNames,jdbcType=VARCHAR},
      #{carrierDriverIds,jdbcType=VARCHAR},
      #{carrierDriverNames,jdbcType=VARCHAR},
      #{carrierIds,jdbcType=VARCHAR},
      #{carrierNames,jdbcType=VARCHAR},
      #{carrierPhone,jdbcType=VARCHAR}, #{carrierVehicle,jdbcType=VARCHAR},
      #{bidingStart,jdbcType=TIMESTAMP}, #{bidingEnd,jdbcType=TIMESTAMP}, #{customerId,jdbcType=BIGINT},
      #{customerName,jdbcType=VARCHAR}, #{customerPhone,jdbcType=VARCHAR}, #{salesOrder,jdbcType=VARCHAR}, 
      #{custContactMan,jdbcType=VARCHAR}, #{sendWhId,jdbcType=BIGINT}, #{sendWhName,jdbcType=VARCHAR}, 
      #{sendMan,jdbcType=VARCHAR}, #{sendPhone,jdbcType=VARCHAR}, #{sendProvince,jdbcType=VARCHAR}, 
      #{sendCity,jdbcType=VARCHAR}, #{sendCounty,jdbcType=VARCHAR}, #{sendAddress,jdbcType=VARCHAR}, 
      #{receiveMan,jdbcType=VARCHAR}, #{receivePhone,jdbcType=VARCHAR}, #{receiveProvince,jdbcType=VARCHAR}, 
      #{receiveCity,jdbcType=VARCHAR}, #{receiveCounty,jdbcType=VARCHAR}, #{receiveAddress,jdbcType=VARCHAR}, 
      #{transportWay,jdbcType=SMALLINT}, #{goodsType,jdbcType=VARCHAR}, #{startDate,jdbcType=TIMESTAMP}, 
      #{arriveDate,jdbcType=TIMESTAMP}, #{isReceipt,jdbcType=SMALLINT}, #{isUrgent,jdbcType=SMALLINT}, 
      #{distributionWay,jdbcType=VARCHAR}, #{attachment1,jdbcType=VARCHAR}, #{attachment1Name,jdbcType=VARCHAR}, 
      #{attachment2,jdbcType=VARCHAR}, #{attachment2Name,jdbcType=VARCHAR}, #{attachment3,jdbcType=VARCHAR}, 
      #{attachment3Name,jdbcType=VARCHAR}, #{attachment4,jdbcType=VARCHAR}, #{attachment4Name,jdbcType=VARCHAR}, 
      #{attachment5,jdbcType=VARCHAR}, #{attachment5Name,jdbcType=VARCHAR}, #{isApproval,jdbcType=SMALLINT}, 
      #{planRemark,jdbcType=VARCHAR}, #{createId,jdbcType=BIGINT}, #{createName,jdbcType=VARCHAR}, 
      #{createDate,jdbcType=TIMESTAMP}, #{updateId,jdbcType=BIGINT}, #{updateName,jdbcType=VARCHAR}, 
      #{updateTime,jdbcType=TIMESTAMP}, #{isDeleted,jdbcType=SMALLINT}, #{carrierCompanyId,jdbcType=BIGINT}, 
      #{companyId,jdbcType=BIGINT}, #{planDays,jdbcType=INTEGER}, #{pubdate,jdbcType=TIMESTAMP}, 
      #{finishDate,jdbcType=TIMESTAMP}, #{cancelDate,jdbcType=TIMESTAMP}, #{cancelMan,jdbcType=VARCHAR}, 
      #{cancelRemark,jdbcType=VARCHAR},#{carrierCompanyName,jdbcType=VARCHAR})
  </insert>
  <update id="updateByPrimaryKey" parameterType="com.lcdt.traffic.model.WaybillPlan">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue Dec 12 09:56:12 CST 2017.
    -->
    update t_waybill_plan
    set plan_code = #{planCode,jdbcType=VARCHAR},
      group_id = #{groupId,jdbcType=BIGINT},
      group_name = #{groupName,jdbcType=VARCHAR},
      carrier_collection_ids = #{carrierCollectionIds,jdbcType=VARCHAR},
      carrier_collection_names = #{carrierCollectionNames,jdbcType=VARCHAR},
      carrier_driver_ids = #{carrierDriverIds,jdbcType=VARCHAR},
      carrier_driver_names = #{carrierDriverNames,jdbcType=VARCHAR},
      carrier_ids = #{carrierIds,jdbcType=VARCHAR},
      carrier_names = #{carrierNames,jdbcType=VARCHAR},
      carrier_phone = #{carrierPhone,jdbcType=VARCHAR},
      carrier_vehicle = #{carrierVehicle,jdbcType=VARCHAR},
      plan_source = #{planSource,jdbcType=VARCHAR},
      plan_status = #{planStatus,jdbcType=VARCHAR},
      send_card_status = #{sendCardStatus,jdbcType=SMALLINT},
      send_order_type = #{sendOrderType,jdbcType=SMALLINT},
      carrier_type = #{carrierType,jdbcType=SMALLINT},
      biding_start = #{bidingStart,jdbcType=TIMESTAMP},
      biding_end = #{bidingEnd,jdbcType=TIMESTAMP},
      customer_id = #{customerId,jdbcType=BIGINT},
      customer_name = #{customerName,jdbcType=VARCHAR},
      customer_phone = #{customerPhone,jdbcType=VARCHAR},
      sales_order = #{salesOrder,jdbcType=VARCHAR},
      cust_contact_man = #{custContactMan,jdbcType=VARCHAR},
      send_wh_id = #{sendWhId,jdbcType=BIGINT},
      send_wh_name = #{sendWhName,jdbcType=VARCHAR},
      send_man = #{sendMan,jdbcType=VARCHAR},
      send_phone = #{sendPhone,jdbcType=VARCHAR},
      send_province = #{sendProvince,jdbcType=VARCHAR},
      send_city = #{sendCity,jdbcType=VARCHAR},
      send_county = #{sendCounty,jdbcType=VARCHAR},
      send_address = #{sendAddress,jdbcType=VARCHAR},
      receive_man = #{receiveMan,jdbcType=VARCHAR},
      receive_phone = #{receivePhone,jdbcType=VARCHAR},
      receive_province = #{receiveProvince,jdbcType=VARCHAR},
      receive_city = #{receiveCity,jdbcType=VARCHAR},
      receive_county = #{receiveCounty,jdbcType=VARCHAR},
      receive_address = #{receiveAddress,jdbcType=VARCHAR},
      transport_way = #{transportWay,jdbcType=SMALLINT},
      goods_type = #{goodsType,jdbcType=VARCHAR},
      start_date = #{startDate,jdbcType=TIMESTAMP},
      arrive_date = #{arriveDate,jdbcType=TIMESTAMP},
      is_receipt = #{isReceipt,jdbcType=SMALLINT},
      is_urgent = #{isUrgent,jdbcType=SMALLINT},
      distribution_way = #{distributionWay,jdbcType=VARCHAR},
      attachment1 = #{attachment1,jdbcType=VARCHAR},
      attachment1_name = #{attachment1Name,jdbcType=VARCHAR},
      attachment2 = #{attachment2,jdbcType=VARCHAR},
      attachment2_name = #{attachment2Name,jdbcType=VARCHAR},
      attachment3 = #{attachment3,jdbcType=VARCHAR},
      attachment3_name = #{attachment3Name,jdbcType=VARCHAR},
      attachment4 = #{attachment4,jdbcType=VARCHAR},
      attachment4_name = #{attachment4Name,jdbcType=VARCHAR},
      attachment5 = #{attachment5,jdbcType=VARCHAR},
      attachment5_name = #{attachment5Name,jdbcType=VARCHAR},
      is_approval = #{isApproval,jdbcType=SMALLINT},
      plan_remark = #{planRemark,jdbcType=VARCHAR},
      update_id = #{updateId,jdbcType=BIGINT},
      update_name = #{updateName,jdbcType=VARCHAR},
      update_time = #{updateTime,jdbcType=TIMESTAMP},
      is_deleted = #{isDeleted,jdbcType=SMALLINT},
      carrier_company_id = #{carrierCompanyId,jdbcType=BIGINT},
      carrier_company_name = #{carrierCompanyName,jdbcType=VARCHAR},
      company_id = #{companyId,jdbcType=BIGINT},
      plan_days = #{planDays,jdbcType=INTEGER},
      pubdate = #{pubdate,jdbcType=TIMESTAMP},
      finish_date = #{finishDate,jdbcType=TIMESTAMP},
      cancel_date = #{cancelDate,jdbcType=TIMESTAMP},
      cancel_man = #{cancelMan,jdbcType=VARCHAR},
      cancel_remark = #{cancelRemark,jdbcType=VARCHAR}
    where waybill_plan_id = #{waybillPlanId,jdbcType=BIGINT}
  </update>




  <update id="updateWaybillPlan" parameterType="com.lcdt.traffic.model.WaybillPlan">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue Dec 12 09:56:12 CST 2017.
    -->
    update t_waybill_plan
    <set>
      <if test="planCode != null">
        plan_code = #{planCode,jdbcType=VARCHAR},
      </if>
      <if test="groupId != null">
        group_id = #{groupId,jdbcType=BIGINT},
      </if>
      <if test="groupName != null">
        group_name = #{groupName,jdbcType=VARCHAR},
      </if>
      <if test="planSource != null">
        plan_source = #{planSource,jdbcType=VARCHAR},
      </if>
      <if test="planStatus != null">
        plan_status = #{planStatus,jdbcType=VARCHAR},
      </if>
      <if test="sendCardStatus != null">
        send_card_status = #{sendCardStatus,jdbcType=SMALLINT},
      </if>
      <if test="sendOrderType != null">
        send_order_type = #{sendOrderType,jdbcType=SMALLINT},
      </if>
      <if test="carrierType != null">
        carrier_type = #{carrierType,jdbcType=SMALLINT},
      </if>
      <if test="carrierCollectionIds != null">
        carrier_collection_ids = #{carrierCollectionIds,jdbcType=VARCHAR},
      </if>
      <if test="carrierCollectionNames != null">
        carrier_collection_names = #{carrierCollectionNames,jdbcType=VARCHAR},
      </if>
      <if test="carrierPhone != null">
        carrier_phone = #{carrierPhone,jdbcType=VARCHAR},
      </if>
      <if test="carrierVehicle != null">
        carrier_vehicle = #{carrierVehicle,jdbcType=VARCHAR},
      </if>
      <if test="carrierDriverIds != null">
        carrier_driver_ids = #{carrierDriverIds,jdbcType=VARCHAR},
      </if>
      <if test="carrierDriverNames != null">
        carrier_driver_names = #{carrierDriverNames,jdbcType=VARCHAR},
      </if>
      <if test="carrierIds != null">
        carrier_ids = #{carrierIds,jdbcType=VARCHAR},
      </if>
      <if test="carrierNames != null">
        carrier_names = #{carrierNames,jdbcType=VARCHAR},
      </if>
      <if test="bidingStart != null">
        biding_start = #{bidingStart,jdbcType=TIMESTAMP},
      </if>
      <if test="bidingEnd != null">
        biding_end = #{bidingEnd,jdbcType=TIMESTAMP},
      </if>
      <if test="customerId != null">
        customer_id = #{customerId,jdbcType=BIGINT},
      </if>
      <if test="customerName != null">
        customer_name = #{customerName,jdbcType=VARCHAR},
      </if>
      <if test="customerPhone != null">
        customer_phone = #{customerPhone,jdbcType=VARCHAR},
      </if>
      <if test="salesOrder != null">
        sales_order = #{salesOrder,jdbcType=VARCHAR},
      </if>
      <if test="custContactMan != null">
        cust_contact_man = #{custContactMan,jdbcType=VARCHAR},
      </if>
      <if test="sendWhId != null">
        send_wh_id = #{sendWhId,jdbcType=BIGINT},
      </if>
      <if test="sendWhName != null">
        send_wh_name = #{sendWhName,jdbcType=VARCHAR},
      </if>
      <if test="sendMan != null">
        send_man = #{sendMan,jdbcType=VARCHAR},
      </if>
      <if test="sendPhone != null">
        send_phone = #{sendPhone,jdbcType=VARCHAR},
      </if>
      <if test="sendProvince != null">
        send_province = #{sendProvince,jdbcType=VARCHAR},
      </if>
      <if test="sendCity != null">
        send_city = #{sendCity,jdbcType=VARCHAR},
      </if>
      <if test="sendCounty != null">
        send_county = #{sendCounty,jdbcType=VARCHAR},
      </if>
      <if test="sendCounty != null">
        send_county = #{sendCounty,jdbcType=VARCHAR},
      </if>
      <if test="sendAddress != null">
        send_address = #{sendAddress,jdbcType=VARCHAR},
      </if>
      <if test="receiveMan != null">
        receive_man = #{receiveMan,jdbcType=VARCHAR},
      </if>
      <if test="receivePhone != null">
        receive_phone = #{receivePhone,jdbcType=VARCHAR},
      </if>
      <if test="receiveProvince != null">
        receive_province = #{receiveProvince,jdbcType=VARCHAR},
      </if>
      <if test="receiveCity != null">
        receive_city = #{receiveCity,jdbcType=VARCHAR},
      </if>
      <if test="receiveCounty != null">
        receive_county = #{receiveCounty,jdbcType=VARCHAR},
      </if>
      <if test="receiveAddress != null">
        receive_address = #{receiveAddress,jdbcType=VARCHAR},
      </if>
      <if test="transportWay != null">
        transport_way = #{transportWay,jdbcType=SMALLINT},
      </if>
      <if test="goodsType != null">
        goods_type = #{goodsType,jdbcType=VARCHAR},
      </if>
      <if test="startDate != null">
        start_date = #{startDate,jdbcType=TIMESTAMP},
      </if>
      <if test="arriveDate != null">
        arrive_date = #{arriveDate,jdbcType=TIMESTAMP},
      </if>
      <if test="isReceipt != null">
        is_receipt = #{isReceipt,jdbcType=SMALLINT},
      </if>
      <if test="isUrgent != null">
        is_urgent = #{isUrgent,jdbcType=SMALLINT},
      </if>
      <if test="distributionWay != null">
        distribution_way = #{distributionWay,jdbcType=VARCHAR},
      </if>
      <if test="attachment1 != null">
        attachment1 = #{attachment1,jdbcType=VARCHAR},
      </if>
      <if test="attachment1Name != null">
        attachment1_name = #{attachment1Name,jdbcType=VARCHAR},
      </if>
      <if test="attachment2 != null">
        attachment2 = #{attachment2,jdbcType=VARCHAR},
      </if>
      <if test="attachment2Name != null">
        attachment2_name = #{attachment2Name,jdbcType=VARCHAR},
      </if>
      <if test="attachment3 != null">
        attachment3 = #{attachment3,jdbcType=VARCHAR},
      </if>
      <if test="attachment3Name != null">
        attachment3_name = #{attachment3Name,jdbcType=VARCHAR},
      </if>
      <if test="attachment4 != null">
        attachment4 = #{attachment4,jdbcType=VARCHAR},
      </if>
      <if test="attachment4Name != null">
        attachment4_name = #{attachment4Name,jdbcType=VARCHAR},
      </if>
      <if test="attachment5 != null">
        attachment5 = #{attachment5,jdbcType=VARCHAR},
      </if>
      <if test="attachment5Name != null">
        attachment5_name = #{attachment5Name,jdbcType=VARCHAR},
      </if>
      <if test="isApproval != null">
        is_approval = #{isApproval,jdbcType=SMALLINT},
      </if>
      <if test="planRemark != null">
        plan_remark = #{planRemark,jdbcType=VARCHAR},
      </if>
      <if test="createId != null">
        create_id = #{createId,jdbcType=BIGINT},
      </if>
      <if test="createName != null">
        create_name = #{createName,jdbcType=VARCHAR},
      </if>
      <if test="createDate != null">
        create_date = #{createDate,jdbcType=TIMESTAMP},
      </if>
      <if test="updateId != null">
      update_id = #{updateId,jdbcType=BIGINT},
      </if>
      <if test="updateName != null">
        update_name = #{updateName,jdbcType=VARCHAR},
      </if>
      <if test="updateTime != null">
        update_time = #{updateTime,jdbcType=TIMESTAMP},
      </if>
      <if test="isDeleted != null">
        is_deleted = #{isDeleted,jdbcType=SMALLINT},
      </if>
      <if test="carrierCompanyId != null">
        carrier_company_id = #{carrierCompanyId,jdbcType=BIGINT},
      </if>
      <if test="carrierCompanyName != null">
        carrier_company_name = #{carrierCompanyName,jdbcType=VARCHAR},
      </if>

      <if test="companyId != null">
        company_id = #{companyId,jdbcType=BIGINT},
      </if>
      <if test="planDays != null">
        plan_days = #{planDays,jdbcType=INTEGER},
      </if>
      <if test="pubdate != null">
        pubdate = #{pubdate,jdbcType=TIMESTAMP},
      </if>
      <if test="finishDate != null">
        finish_date = #{finishDate,jdbcType=TIMESTAMP},
      </if>
      <if test="cancelDate != null">
        cancel_date = #{cancelDate,jdbcType=TIMESTAMP},
      </if>
      <if test="cancelMan != null">
        cancel_man = #{cancelMan,jdbcType=VARCHAR},
      </if>
      <if test="cancelRemark != null">
        cancel_remark = #{cancelRemark,jdbcType=VARCHAR}
      </if>

    </set>
    where waybill_plan_id = #{waybillPlanId,jdbcType=BIGINT}
  </update>



  <select id="selectByPrimaryKey"  parameterType="java.util.Map"  resultMap="BaseResultMap">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue Dec 12 09:56:12 CST 2017.
    -->
    select waybill_plan_id, plan_code, serial_code, group_id, group_name, plan_source, 
    plan_status, send_card_status, send_order_type, carrier_type,carrier_collection_ids, carrier_collection_names,
    carrier_phone, carrier_vehicle, biding_start, biding_end,
    customer_id, customer_name, customer_phone, sales_order, cust_contact_man, send_wh_id, 
    send_wh_name, send_man, send_phone, send_province, send_city, send_county, send_address, 
    receive_man, receive_phone, receive_province, receive_city, receive_county, receive_address, 
    transport_way, goods_type, start_date, arrive_date, is_receipt, is_urgent, distribution_way, 
    attachment1, attachment1_name, attachment2, attachment2_name, attachment3, attachment3_name, 
    attachment4, attachment4_name, attachment5, attachment5_name, is_approval, plan_remark, 
    create_id, create_name, create_date, update_id, update_name, update_time, is_deleted, 
    carrier_company_id, company_id, plan_days, pubdate, finish_date, cancel_date, cancel_man,
    carrier_driver_ids,carrier_driver_names,carrier_ids,carrier_names,
    cancel_remark,carrier_company_name
    from t_waybill_plan
    <where>
        <if test="waybillPlanId!=null">
          and waybill_plan_id = #{waybillPlanId,jdbcType=BIGINT}
        </if>
        <if test="companyId!=null and companyId>0">
          and company_id = #{companyId,jdbcType=BIGINT}
        </if>
        <if test="isDeleted!=null">
          and  is_deleted = #{isDeleted,jdbcType=SMALLINT}
        </if>
    </where>

  </select>

  <select id="selectByCondition" parameterType="java.util.Map" resultMap="BaseResultMap">
        <!--
          WARNING - @mbg.generated
          This element is automatically generated by MyBatis Generator, do not modify.
          This element was generated on Tue Dec 12 09:56:12 CST 2017.
        -->
        select waybill_plan_id, plan_code, serial_code, group_id, group_name, plan_source,
              plan_status, send_card_status, send_order_type, carrier_type, carrier_collection_ids, carrier_collection_names,
              carrier_phone, carrier_vehicle,biding_start, biding_end,
              customer_id, customer_name, customer_phone, sales_order, cust_contact_man, send_wh_id,
              send_wh_name, send_man, send_phone, send_province, send_city, send_county, send_address,
              receive_man, receive_phone, receive_province, receive_city, receive_county, receive_address,
              transport_way, goods_type, start_date, arrive_date, is_receipt, is_urgent, distribution_way,
              attachment1, attachment1_name, attachment2, attachment2_name, attachment3, attachment3_name,
              attachment4, attachment4_name, attachment5, attachment5_name, is_approval, plan_remark,
              create_id, create_name, create_date, update_id, update_name, update_time, is_deleted,
              carrier_company_id, company_id, plan_days, pubdate, finish_date, cancel_date, cancel_man,
              cancel_remark,carrier_company_name,carrier_driver_ids,carrier_driver_names,carrier_ids,carrier_names
        from t_waybill_plan
        <where>
          <if test="isDeleted!=null">
            and  is_deleted = #{isDeleted,jdbcType=SMALLINT}
          </if>
          <if test=" carrierCompanyId!=null">
            and  carrier_company_id = #{ carrierCompanyId,jdbcType=BIGINT}
          </if>
          <if test=" carrierCompanyId4leaveMsg!=null">
            and (carrier_company_id = #{ carrierCompanyId4leaveMsg,jdbcType=BIGINT} or company_id = #{companyId,jdbcType=BIGINT} )
          </if>

          <if test="companyId!=null">
            and  company_id = #{companyId,jdbcType=BIGINT}
          </if>
          <if test="groupIds!=null and groupIds!=''">
            and  ${groupIds}
          </if>
          <if test="customerName!=null and customerName!=''">
            and customer_name like concat('%',#{customerName,jdbcType=VARCHAR},'%')
          </if>
          <if test="serialCode!=null and serialCode!=''">
            and serial_code like concat('%',#{serialCode,jdbcType=VARCHAR},'%')
          </if>
          <if test="planStatus != null and planStatus!=''">
            and plan_status = #{planStatus,jdbcType=VARCHAR}
          </if>
          <if test="receiveProvince!=null and receiveProvince!=''">
            and receive_province = #{receiveProvince,jdbcType=VARCHAR}
          </if>
          <if test="receiveCity!=null and receiveCity!=''">
            and receive_city = #{receiveCity,jdbcType=VARCHAR}
          </if>
          <if test="receiveCounty!=null and receiveCounty!=''">
            and receive_county = #{receiveCounty,jdbcType=VARCHAR}
          </if>
          <if test="pubdateBegin != null and pubdateBegin != ''">
            and  pubdate >= #{pubdateBegin,jdbcType=TIMESTAMP}
          </if>
          <if test="pubdateEnd != null and pubdateEnd != ''">
            and  #{pubdateEnd,jdbcType=TIMESTAMP} >= pubdate
          </if>
          <if test="sendOrderType != null">
            and  send_order_type = #{sendOrderType,jdbcType=SMALLINT}
          </if>
          <if test="carrierCompanyIds != null">
            and ${carrierCompanyIds}
          </if>
          <if test="goodsInfo != null and goodsInfo!=''">
            and  waybill_plan_id in (select waybill_plan_id from t_plan_detail where goods_name like concat('%',#{goodsInfo,jdbcType=VARCHAR},'%'))
          </if>
        </where>
        order by waybill_plan_id desc
    </select>


  <!--客户计划（竞价）
    查询条件：计划发布时间
    满足前提条件：计划发布抢单计划的抢单分组里包含当前登录人所在的企业。
    不包括已抢的计划
    就是自己能抢的计划，可能这个计划多家公司都能看见。如果改计划我报价了，就在已抢里面
  -->
  <select id="customerPlan4Bidding" parameterType="java.util.Map" resultMap="CustomerPlanBaseResultMap">
    select '-1' as split_goods_id, waybill_plan_id, plan_code, serial_code, receive_province, receive_city, receive_county,receive_address,company_id,is_deleted
    from t_waybill_plan p1
    <where>
      and plan_status = '15' and waybill_plan_id not in (SELECT waybill_plan_id FROM t_snatch_goods sn where sn.plan_company_id = p1.company_id)
      and  is_deleted = 0
      <if test="serialCode!=null and serialCode!=''">
        and serial_code like concat('%',#{serialCode,jdbcType=VARCHAR},'%')
      </if>
      <if test="customerName!=null and customerName!=''">
        and customer_name like concat('%',#{customerName,jdbcType=VARCHAR},'%')
      </if>
      <if test="receiveProvince!=null and receiveProvince!=''">
        and receive_province = #{receiveProvince,jdbcType=VARCHAR}
      </if>
      <if test="receiveCity!=null and receiveCity!=''">
        and receive_city = #{receiveCity,jdbcType=VARCHAR}
      </if>
      <if test="receiveCounty!=null and receiveCounty!=''">
        and receive_county = #{receiveCounty,jdbcType=VARCHAR}
      </if>
      <if test="pubdateBegin != null and pubdateBegin != ''">
        and  pubdate >= #{pubdateBegin,jdbcType=TIMESTAMP}
      </if>
      <if test="pubdateEnd != null and pubdateEnd != ''">
        and  #{pubdateEnd,jdbcType=TIMESTAMP} >= pubdate
      </if>
      <if test="goodsInfo != null and goodsInfo!=''">
        and  waybill_plan_id in (select waybill_plan_id from t_plan_detail where goods_name like concat('%',#{goodsInfo,jdbcType=VARCHAR},'%'))
      </if>
      <if test="customerCids!=null and customerCids!=''">
        and company_id in(#{customerCids,jdbcType=VARCHAR})
      </if>
      <if test="companyIds!=null and companyIds!=''">
        and ${companyIds}
      </if>
      <if test="carrierCollectionIds!=null and carrierCollectionIds!=''">
        and ${carrierCollectionIds}
      </if>
   </where>
    order by waybill_plan_id desc
  </select>

  <!--客户计划（已报价）
     查询条件：计划发布时间
     满足前提条件：抢单记录关联计划，并且没有产生派单给当前登录人所在的企业
     理解：这个计划我参与报价了，但还没有派单给我 ,只要不是'取消'的就行
  -->
  <select id="customerPlanList4Offer" parameterType="java.util.Map" resultMap="CustomerPlanBaseResultMap">
    select '-1' as split_goods_id,waybill_plan_id, plan_code, serial_code, receive_province, receive_city, receive_county,receive_address,company_id,is_deleted
    from t_waybill_plan p1
    <where>
      and waybill_plan_id in (SELECT waybill_plan_id FROM t_snatch_goods sn where sn.plan_company_id = p1.company_id and sn.is_deleted=0)
      and waybill_plan_id not in (SELECT waybill_plan_id FROM t_split_goods sg where sg.company_id = p1.company_id and sg.is_deleted=0)
      and plan_status != '60'
      and is_deleted = 0
      <if test="serialCode!=null and serialCode!=''">
        and serial_code like concat('%',#{serialCode,jdbcType=VARCHAR},'%')
      </if>
      <if test="customerName!=null and customerName!=''">
        and customer_name like concat('%',#{customerName,jdbcType=VARCHAR},'%')
      </if>
      <if test="receiveProvince!=null and receiveProvince!=''">
        and receive_province = #{receiveProvince,jdbcType=VARCHAR}
      </if>
      <if test="receiveCity!=null and receiveCity!=''">
        and receive_city = #{receiveCity,jdbcType=VARCHAR}
      </if>
      <if test="receiveCounty!=null and receiveCounty!=''">
        and receive_county = #{receiveCounty,jdbcType=VARCHAR}
      </if>
      <if test="pubdateBegin != null and pubdateBegin != ''">
        and pubdate >= #{pubdateBegin,jdbcType=TIMESTAMP}
      </if>
      <if test="pubdateEnd != null and pubdateEnd != ''">
        and #{pubdateEnd,jdbcType=TIMESTAMP} >= pubdate
      </if>
      <if test="goodsInfo != null and goodsInfo!=''">
        and  waybill_plan_id in (select waybill_plan_id from t_plan_detail where goods_name like  concat('%',#{goodsInfo,jdbcType=VARCHAR},'%') and is_deleted=0)
      </if>
      <if test="customerCids!=null and customerCids!=''">
        and company_id in(#{customerCids,jdbcType=VARCHAR})
      </if>

      <if test="companyIds!=null and companyIds!=''">
        and ${companyIds}
      </if>
      <if test="carrierCollectionIds!=null and carrierCollectionIds!=''">
        and ${carrierCollectionIds}
      </if>
    </where>
    order by waybill_plan_id desc
  </select>



  <!--客户计划（已错过）
     查询条件：计划发布时间
     满足前提条件：
          1、我能抢单的计划（不包括已抢的），但是该计划已经派单完成; or
          2、我能抢的计划（不包括已抢的）已经超过竞价的结束时间的；
          3、结束的没有抢单的

                   or (
            waybill_plan_id not in (SELECT waybill_plan_id FROM t_snatch_goods sn where sn.plan_company_id = p1.company_id and sn.is_deleted=0)
            and ( p1.plan_status='30')
          )
   -->
  <select id="customerPlanList4Pass" parameterType="java.util.Map" resultMap="CustomerPlanBaseResultMap">
    select '-1' as split_goods_id, waybill_plan_id, plan_code, serial_code, receive_province, receive_city, receive_county,receive_address,company_id,is_deleted
    from t_waybill_plan p1
    <where>
      and
        (
          ( waybill_plan_id not in (SELECT waybill_plan_id FROM t_snatch_goods sn where sn.plan_company_id = p1.company_id and sn.is_deleted=0)
            and (SELECT SUM(remainder_amount) FROM t_plan_detail pd where pd.company_id = p1.company_id and pd.is_deleted=0)=0
           )
        or (
             waybill_plan_id not in (SELECT waybill_plan_id FROM t_snatch_goods sn where sn.plan_company_id = p1.company_id and sn.is_deleted=0)
            and (now() >= p1.biding_end and p1.biding_end is not NULL)
          )
          or (
           waybill_plan_id not in (SELECT waybill_plan_id FROM t_snatch_goods sn where sn.plan_company_id = p1.company_id and sn.is_deleted=0)
            and p1.plan_status='30' and p1.send_order_type=2
          )
       )
        and  is_deleted = 0
      <if test="serialCode!=null and serialCode!=''">
        and serial_code like concat('%',#{serialCode,jdbcType=VARCHAR},'%')
      </if>
      <if test="customerName!=null and customerName!=''">
        and customer_name like concat('%',#{customerName,jdbcType=VARCHAR},'%')
      </if>
      <if test="receiveProvince!=null and receiveProvince!=''">
        and receive_province = #{receiveProvince,jdbcType=VARCHAR}
      </if>
      <if test="receiveCity!=null and receiveCity!=''">
        and receive_city = #{receiveCity,jdbcType=VARCHAR}
      </if>
      <if test="receiveCounty!=null and receiveCounty!=''">
        and receive_county = #{receiveCounty,jdbcType=VARCHAR}
      </if>
      <if test="pubdateBegin != null and pubdateBegin != ''">
        and  pubdate >= #{pubdateBegin,jdbcType=TIMESTAMP}
      </if>
      <if test="pubdateEnd != null and pubdateEnd != ''">
        and  #{pubdateEnd,jdbcType=TIMESTAMP} >= pubdate
      </if>
      <if test="goodsInfo != null and goodsInfo!=''">
        and  waybill_plan_id in (select waybill_plan_id from t_plan_detail where goods_name like concat('%',#{goodsInfo,jdbcType=VARCHAR},'%')  and is_deleted=0)
      </if>

      <if test="customerCids!=null and customerCids!=''">
        and company_id in(#{customerCids,jdbcType=VARCHAR})
      </if>


      <if test="companyIds!=null and companyIds!=''">
        and ${companyIds}
      </if>
      <if test="carrierCollectionIds!=null and carrierCollectionIds!=''">
        and ${carrierCollectionIds}
      </if>
    </where>
    order by waybill_plan_id desc
  </select>


  <!--客户计划（派车中）
      查询条件：计划发布时间 、派单时间
      满足前提条件：计划派单关联计划，同时派单（派单当前登录人所在的企业）的货物剩余数量>0的

           AND  wp.waybill_plan_id !=''
      and sp.split_goods_id in (
        select a.split_goods_id from t_split_goods_detail as a
        where split_goods_detail_id = (select max(b.split_goods_detail_id)
        from t_split_goods_detail as b
        where a.split_goods_id = b.split_goods_id and b.remain_amount>0)
          and sp.company_id = a.company_id and a.is_deleted=0
      )

   -->
  <select id="customerPlanList4VehicleDoing" parameterType="java.util.Map" resultMap="CustomerPlanBaseResultMap">
    SELECT
    sp.split_goods_id,
    wp.waybill_plan_id,
    wp.plan_code,
    wp.serial_code,
    wp.receive_province,
    wp.receive_city,
    wp.receive_county,
    wp.receive_address,
    wp.company_id,
    wp.is_deleted
    FROM t_split_goods sp
    LEFT JOIN t_waybill_plan wp
    on sp.waybill_plan_id = wp.waybill_plan_id
    <where>
      and wp.plan_status!='60' and wp.plan_status!='50'
      and (select sum(remain_amount) from t_split_goods_detail spd where spd.split_goods_id=sp.split_goods_id)>0
      <if test="isDeleted!=null">
        and  sp.is_deleted = #{isDeleted,jdbcType=SMALLINT},
      </if>
      <if test="serialCode!=null and serialCode!=''">
        and wp.serial_code like concat('%',#{serialCode,jdbcType=VARCHAR},'%')
      </if>
      <if test="customerName!=null and customerName!=''">
        and wp.customer_name like concat('%',#{customerName,jdbcType=VARCHAR},'%')
      </if>
      <if test="receiveProvince!=null and receiveProvince!=''">
        and wp.receive_province = #{receiveProvince,jdbcType=VARCHAR}
      </if>
      <if test="receiveCity!=null and receiveCity!=''">
        and wp.receive_city = #{receiveCity,jdbcType=VARCHAR}
      </if>
      <if test="receiveCounty!=null and receiveCounty!=''">
        and wp.receive_county = #{receiveCounty,jdbcType=VARCHAR}
      </if>
      <!--派单时间-->
      <if test="disDateBegin != null and disDateBegin != ''">
        and  sp.create_date >= #{disDateBegin,jdbcType=TIMESTAMP}
      </if>
      <if test="disDateEnd != null and disDateEnd != ''">
        and  #{disDateEnd,jdbcType=TIMESTAMP} >= sp.create_date
      </if>
      <if test="goodsInfo != null and goodsInfo!=''">
        and  wp.waybill_plan_id in (select waybill_plan_id from t_plan_detail where goods_name like  concat('%',#{goodsInfo,jdbcType=VARCHAR},'%')  and is_deleted=0)
      </if>
      <if test="customerCids!=null and customerCids!=''">
        and wp.company_id in(#{customerCids,jdbcType=VARCHAR})
      </if>

      <if test="companyIds!=null and companyIds!=''"> <!--创建企业-->
        and ${companyIds}
      </if>
      <if test="carrierCollectionIds!=null and carrierCollectionIds!=''"> <!--承运企业-->
        and ${carrierCollectionIds}
      </if>

    </where>
    order by waybill_plan_id desc
  </select>

  <!--客户计划（已派车）
      查询条件：派单时间
       满足前提条件：计划派单关联计划，同时派单（派单当前登录人所在的企业）的货物剩余数量=0的

             and sp.split_goods_id in (
        select a.split_goods_id from t_split_goods_detail as a
        where split_goods_detail_id = (select max(b.split_goods_detail_id)
        from t_split_goods_detail as b
        where a.split_goods_id = b.split_goods_id and b.remain_amount=0)
        and sp.company_id = a.company_id and a.is_deleted=0
      )
   -->
  <select id="customerPlanList4VehicleHave" parameterType="java.util.Map" resultMap="CustomerPlanBaseResultMap">
    SELECT
    sp.split_goods_id,
    wp.waybill_plan_id,
    wp.plan_code,
    wp.serial_code,
    wp.receive_province,
    wp.receive_city,
    wp.receive_county,
    wp.receive_address,
    wp.company_id,
    wp.is_deleted
    FROM t_split_goods sp
    LEFT JOIN t_waybill_plan wp
    on sp.waybill_plan_id = wp.waybill_plan_id
    <where>
      and wp.plan_status!='60' and wp.plan_status!='50'
      and (select sum(remain_amount) from t_split_goods_detail spd where spd.split_goods_id=sp.split_goods_id)=0
      <if test="isDeleted!=null">
        and  sp.is_deleted = #{isDeleted,jdbcType=SMALLINT},
      </if>
      <if test="serialCode!=null and serialCode!=''">
        and wp.serial_code like concat('%',#{serialCode,jdbcType=VARCHAR},'%')
      </if>
      <if test="customerName!=null and customerName!=''">
        and wp.customer_name like concat('%',#{customerName,jdbcType=VARCHAR},'%')
      </if>
      <if test="receiveProvince!=null and receiveProvince!=''">
        and wp.receive_province = #{receiveProvince,jdbcType=VARCHAR}
      </if>
      <if test="receiveCity!=null and receiveCity!=''">
        and wp.receive_city = #{receiveCity,jdbcType=VARCHAR}
      </if>
      <if test="receiveCounty!=null and receiveCounty!=''">
        and wp.receive_county = #{receiveCounty,jdbcType=VARCHAR}
      </if>
      <!--派单时间-->
      <if test="disDateBegin != null and disDateBegin != ''">
        and  sp.create_date >= #{disDateBegin,jdbcType=TIMESTAMP}
      </if>
      <if test="disDateEnd != null and disDateEnd != ''">
        and  #{disDateEnd,jdbcType=TIMESTAMP} >= sp.create_date
      </if>
      <if test="goodsInfo != null and goodsInfo!=''">
        and  wp.waybill_plan_id in (select waybill_plan_id from t_plan_detail where goods_name like concat('%',#{goodsInfo,jdbcType=VARCHAR},'%') and is_deleted=0)
      </if>
      <if test="customerCids!=null and customerCids!=''">
        and wp.company_id in(#{customerCids,jdbcType=VARCHAR})
      </if>
      <if test="companyIds!=null and companyIds!=''">
        and ${companyIds}
      </if>
      <if test="carrierCollectionIds!=null and carrierCollectionIds!=''"> <!--承运企业-->
        and ${carrierCollectionIds}
      </if>
    </where>
    order by waybill_plan_id desc
  </select>

  <!--客户计划（已完成）
         查询条件：派单时间
          满足前提条件：计划派单关联计划，派单（派单当前登录人所在的企业）的货物剩余数量=0的，并且该派单下的运单全部完成的。

                and sp.split_goods_id in (
          select a.split_goods_id from t_split_goods_detail as a
          where split_goods_detail_id = (select max(b.split_goods_detail_id)
          from t_split_goods_detail as b
          where a.split_goods_id = b.split_goods_id and b.remain_amount=0)
          and sp.company_id = a.company_id and a.is_deleted=0
      )
     -->
  <select id="customerPlanList4Completed" parameterType="java.util.Map" resultMap="CustomerPlanBaseResultMap">
    SELECT
    sp.split_goods_id,
    wp.waybill_plan_id,
    wp.plan_code,
    wp.serial_code,
    wp.receive_province,
    wp.receive_city,
    wp.receive_county,
    wp.receive_address,
    wp.company_id,
    wp.is_deleted
    FROM t_split_goods sp
    LEFT JOIN t_waybill_plan wp
    on sp.waybill_plan_id = wp.waybill_plan_id
    <where>
      and (select sum(remain_amount) from t_split_goods_detail spd where spd.split_goods_id=sp.split_goods_id)=0
      and (SELECT count(1) from t_waybill wb where wb.split_goods_id=sp.split_goods_id and wb.company_id = sp.company_id and wb.is_deleted=0 AND wb.waybill_status!=7 )=0
      <if test="isDeleted!=null">
        and  sp.is_deleted = #{isDeleted,jdbcType=SMALLINT},
      </if>
      <if test="serialCode!=null and serialCode!=''">
        and wp.serial_code like concat('%',#{serialCode,jdbcType=VARCHAR},'%')
      </if>
      <if test="customerName!=null and customerName!=''">
        and wp.customer_name like concat('%',#{customerName,jdbcType=VARCHAR},'%')
      </if>
      <if test="receiveProvince!=null and receiveProvince!=''">
        and wp.receive_province = #{receiveProvince,jdbcType=VARCHAR}
      </if>
      <if test="receiveCity!=null and receiveCity!=''">
        and wp.receive_city = #{receiveCity,jdbcType=VARCHAR}
      </if>
      <if test="receiveCounty!=null and receiveCounty!=''">
        and wp.receive_county = #{receiveCounty,jdbcType=VARCHAR}
      </if>
      <!--派单时间-->
      <if test="disDateBegin != null and disDateBegin != ''">
        and  sp.create_date >= #{disDateBegin,jdbcType=TIMESTAMP}
      </if>
      <if test="disDateEnd != null and disDateEnd != ''">
        and  #{disDateEnd,jdbcType=TIMESTAMP} >= sp.create_date
      </if>
      <if test="goodsInfo != null and goodsInfo!=''">
        and  wp.waybill_plan_id in (select waybill_plan_id from t_plan_detail where goods_name like concat('%',#{goodsInfo,jdbcType=VARCHAR},'%') and is_deleted=0)
      </if>
      <if test="customerCids!=null and customerCids!=''">
        and wp.company_id in(#{customerCids,jdbcType=VARCHAR})
      </if>
      <if test="companyIds!=null and companyIds!=''">
        and ${companyIds}
      </if>
      <if test="carrierCollectionIds!=null and carrierCollectionIds!=''"> <!--承运企业-->
        and ${carrierCollectionIds}
      </if>
    </where>
    order by waybill_plan_id desc
  </select>

  <!--客户计划（已取消）
         查询条件：派单时间
          满足前提条件：派单货物的原始和剩余数量都是0的

         and sp.split_goods_id in (
      SELECT sgd.split_goods_id From t_split_goods_detail sgd where wp.company_id = sgd.company_id and sgd.is_deleted=0
             and (select SUM(remain_amount+allot_amount) from t_split_goods_detail sgd1 where wp.company_id = sgd1.company_id and sgd1.is_deleted=0)=0
      )
      OR
     -->
  <select id="customerPlanList4Cancel" parameterType="java.util.Map" resultMap="CustomerPlanBaseResultMap">
    SELECT
    sp.split_goods_id,
    wp.waybill_plan_id,
    wp.plan_code,
    wp.serial_code,
    wp.receive_province,
    wp.receive_city,
    wp.receive_county,
    wp.receive_address,
    wp.company_id,
    wp.is_deleted
    FROM t_split_goods sp
    LEFT JOIN t_waybill_plan wp
    on sp.waybill_plan_id = wp.waybill_plan_id
    <where>
       and wp.plan_status='60'
      <if test="isDeleted!=null">
        and sp.is_deleted = #{isDeleted,jdbcType=SMALLINT},
      </if>
      <if test="serialCode!=null and serialCode!=''">
        and wp.serial_code like concat('%',#{serialCode,jdbcType=VARCHAR},'%')
      </if>
      <if test="customerName!=null and customerName!=''">
        and wp.customer_name like concat('%',#{customerName,jdbcType=VARCHAR},'%')
      </if>
      <if test="receiveProvince!=null and receiveProvince!=''">
        and wp.receive_province = #{receiveProvince,jdbcType=VARCHAR}
      </if>
      <if test="receiveCity!=null and receiveCity!=''">
        and wp.receive_city = #{receiveCity,jdbcType=VARCHAR}
      </if>
      <if test="receiveCounty!=null and receiveCounty!=''">
        and wp.receive_county = #{receiveCounty,jdbcType=VARCHAR}
      </if>
      <if test="customerCids!=null and customerCids!=''">
        and wp.company_id in(#{customerCids,jdbcType=VARCHAR})
      </if>
      <!--派单时间-->
      <if test="disDateBegin != null and disDateBegin != ''">
        and  sp.create_date >= #{disDateBegin,jdbcType=TIMESTAMP}
      </if>
      <if test="disDateEnd != null and disDateEnd != ''">
        and  #{disDateEnd,jdbcType=TIMESTAMP} >= sp.create_date
      </if>
      <if test="goodsInfo != null and goodsInfo!=''">
        and  wp.waybill_plan_id in (select waybill_plan_id from t_plan_detail where goods_name like concat('%',#{goodsInfo,jdbcType=VARCHAR},'%') and is_deleted=0)
      </if>
      <if test="companyIds!=null and companyIds!=''">
        and ${companyIds}
      </if>
      <if test="carrierCollectionIds!=null and carrierCollectionIds!=''"> <!--承运企业-->
        and ${carrierCollectionIds}
      </if>
    </where>
    order by waybill_plan_id desc
  </select>

  <resultMap id="snatchBill4WaittingMap" type="com.lcdt.traffic.dto.SnatchBill4WaittingRdto">
    <id column="waybill_plan_id" jdbcType="BIGINT" property="waybillPlanId" />
    <result column="receive_province" jdbcType="VARCHAR" property="receiveProvince" />
    <result column="receive_city" jdbcType="VARCHAR" property="receiveCity" />
    <result column="receive_county" jdbcType="VARCHAR" property="receiveCounty" />
    <result column="receive_address" jdbcType="VARCHAR" property="receiveAddress" />
    <result column="send_province" jdbcType="VARCHAR" property="sendProvince" />
    <result column="send_city" jdbcType="VARCHAR" property="sendCity" />
    <result column="send_county" jdbcType="VARCHAR" property="sendCounty" />
    <result column="send_address" jdbcType="VARCHAR" property="sendAddress" />
    <result column="company_id" jdbcType="BIGINT" property="companyId" />
    <result column="plan_status" jdbcType="VARCHAR" property="planStatus" />
    <result column="send_man" jdbcType="VARCHAR" property="sendMan" />
    <result column="send_phone" jdbcType="VARCHAR" property="sendPhone" />
    <result column="receive_man" jdbcType="VARCHAR" property="receiveMan" />
    <result column="receive_phone" jdbcType="VARCHAR" property="receivePhone" />
    <result column="transport_way" jdbcType="SMALLINT" property="transportWay" />
    <result column="plan_remark" jdbcType="VARCHAR" property="planRemark" />
    <result column="start_date" jdbcType="TIMESTAMP" property="startDate" />
    <result column="arrive_date" jdbcType="TIMESTAMP" property="arriveDate" />
    <result column="serial_code" jdbcType="VARCHAR" property="serialCode" />
    <result column="create_id" jdbcType="BIGINT" property="createId" />

    <!--计划详细-->
    <collection property="planDetailList" column="{waybillPlanId=waybill_plan_id}"
                ofType="com.lcdt.traffic.model.PlanDetail" javaType="ArrayList"
                select="com.lcdt.traffic.dao.PlanDetailMapper.selectByWaybillPlanId" />

  </resultMap>


  <!--司机（待抢）
  满足前提条件：司机隶属于竞价计价发布时选的司机分组，并且司机未对该计划的抢单
-->
  <select id="wattingSnatch4Driver" parameterType="java.util.Map" resultMap="snatchBill4WaittingMap">
    select waybill_plan_id,send_province,send_city,send_county,send_address,receive_province,receive_city,receive_county,receive_address,start_date,
           arrive_date,company_id,plan_status,transport_way,send_man,send_phone,receive_man,receive_phone,plan_remark,serial_code,create_id
    from t_waybill_plan p1
    <where>
      and p1.send_order_type='2'
      and waybill_plan_id not in (SELECT waybill_plan_id FROM t_snatch_goods sn where sn.offer_id = ${offerId} and sn.waybill_plan_id=p1.waybill_plan_id)
      and  is_deleted = 0
      <if test="carrierDriverGroupIds!=null and carrierDriverGroupIds!=''">
        and ${carrierDriverGroupIds}
      </if>
      <if test="ownCompanyIds!=null and ownCompanyIds!=''">
        and ${ownCompanyIds}
      </if>

    </where>
    order by ${orderFiled} ${orderDesc}
  </select>



  <!--司机（已抢）
  满足前提条件：司机隶属于竞价计价发布时选的司机分组，并且司机未对该计划的抢单
  -->
  <select id="completeSnatch4Driver" parameterType="java.util.Map" resultMap="snatchBill4WaittingMap">
    select waybill_plan_id,send_province,send_city,send_county,send_address,receive_province,receive_city,receive_county,receive_address,start_date,
    arrive_date,company_id,plan_status,transport_way,send_man,send_phone,receive_man,receive_phone,plan_remark,serial_code,create_id
    from t_waybill_plan p1
    <where>
      and p1.send_order_type='2'
      and waybill_plan_id in (SELECT waybill_plan_id FROM t_snatch_goods sn where sn.offer_id = ${offerId} and sn.waybill_plan_id=p1.waybill_plan_id)
      and  is_deleted = 0
      <if test="carrierDriverGroupIds!=null and carrierDriverGroupIds!=''">
        and ${carrierDriverGroupIds}
      </if>
      <if test="ownCompanyIds!=null and ownCompanyIds!=''">
        and ${ownCompanyIds}
      </if>
    </where>
    order by ${orderFiled} ${orderDesc}
  </select>

</mapper>