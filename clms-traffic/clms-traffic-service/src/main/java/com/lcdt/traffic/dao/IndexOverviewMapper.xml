<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.lcdt.traffic.dao.IndexOverviewMapper">

    <select id="selectPlan" resultType="Map" parameterType="Map">
        select sum(case when plan_status=30 then 1 else 0 end) as paidanzhong,
        sum(case when plan_status=15 then 1 else 0 end) as jingjiazhong,
        sum(case when send_card_status=1 then 1 else 0 end) as yipaidan,
        sum(case when send_card_status=2 then 1 else 0 end) as yipaiche,
        sum(case when plan_status=50 then 1 else 0 end) as yiwancheng
        from t_waybill_plan
        <where>
            company_id=#{companyId,jdbcType=BIGINT} and is_deleted=0
            <if test="planType==0">
                and carrier_company_id=company_id
            </if>
            <if test="planType==1">
                and carrier_company_id!=company_id
            </if>
            <if test="groupIds!=null and groupIds.size>0">
                and group_id in
                <foreach item="item" index="index" collection="groupIds" open="(" separator="," close=")">
                    #{item,jdbcType=BIGINT}
                </foreach>
            </if>
            <if test="pubdate!=null and pubdate!=''">
                <![CDATA[
              and pubdate >= #{pubdate,jdbcType=TIMESTAMP} and pubdate < #{pubdate1,jdbcType=TIMESTAMP}
            ]]>
            </if>
        </where>
    </select>
    <select id="selectWaybill" resultType="Map" parameterType="Map">
        select sum(case when waybill_status=1 then 1 else 0 end) as daifahuo,
        sum(case when waybill_status=2 then 1 else 0 end) as yiruchang,
        sum(case when waybill_status=3 then 1 else 0 end) as yichuku,
        sum(case when waybill_status=4 then 1 else 0 end) as yunshuzhong,
        sum(case when waybill_status=5 then 1 else 0 end) as yixiehuo,
        sum(case when waybill_status=6 then 1 else 0 end) as yiqianshou,
        sum(case when waybill_status=7 then 1 else 0 end) as yiwancheng
        from t_waybill
        <where>
            company_id=#{companyId,jdbcType=BIGINT} and is_deleted=0
            <if test="waybillType==0">
                and carrier_company_id=company_id
            </if>
            <if test="waybillType==1">
                and carrier_company_id!=company_id
            </if>
            <if test="groupIds!=null and groupIds.size>0">
                and group_id in
                <foreach item="item" index="index" collection="groupIds" open="(" separator="," close=")">
                    #{item,jdbcType=BIGINT}
                </foreach>
            </if>
            <if test="pubdate!=null and pubdate!=''">
                <![CDATA[
              and pub_date >= #{pubdate,jdbcType=TIMESTAMP} and pub_date < #{pubdate1,jdbcType=TIMESTAMP}
            ]]>
            </if>
        </where>
    </select>
    <select id="selectPlanAndWaybill" resultType="Map" parameterType="Long">
        select sum(case when (plan_status=15 or plan_status=20 or plan_status=30 or plan_status=40) then 1 else 0 end) as plan_waybill
        from t_waybill_plan where company_id=#{0} and is_deleted=0
        UNION
        select sum(case when (waybill_status!=7 and waybill_status=8) then 1 else 0 end)
        from t_waybill where company_id=#{0} and is_deleted=0
    </select>
    <select id="selectVehicleAndDriver" resultType="Map" parameterType="Long">
        select count(1) as vehicle_driver from t_own_vehicle
        where company_id=#{0} and is_deleted=0
        UNION
        select count(1) from t_own_driver
        where company_id=#{0} and is_deleted=0
    </select>
</mapper>