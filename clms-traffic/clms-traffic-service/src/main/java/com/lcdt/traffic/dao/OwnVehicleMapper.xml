<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.lcdt.traffic.dao.OwnVehicleMapper">
  <resultMap id="BaseResultMap" type="com.lcdt.traffic.model.OwnVehicle">
    <id column="own_vehicle_id" jdbcType="BIGINT" property="ownVehicleId" />
    <result column="affiliated_company" jdbcType="VARCHAR" property="affiliatedCompany" />
    <result column="vehicle_num" jdbcType="VARCHAR" property="vehicleNum" />
    <result column="vehicle_trailer_num" jdbcType="VARCHAR" property="vehicleTrailerNum" />
    <result column="vehicle_category" jdbcType="SMALLINT" property="vehicleCategory" />
    <result column="vehicle_type" jdbcType="VARCHAR" property="vehicleType" />
    <result column="vehicle_length" jdbcType="VARCHAR" property="vehicleLength" />
    <result column="vehicle_load" jdbcType="DECIMAL" property="vehicleLoad" />
    <result column="vehicle_driver_phone" jdbcType="VARCHAR" property="vehicleDriverPhone" />
    <result column="vehicle_driver_name" jdbcType="VARCHAR" property="vehicleDriverName" />
    <result column="vehicle_brand" jdbcType="VARCHAR" property="vehicleBrand" />
    <result column="vehicle_specifications" jdbcType="VARCHAR" property="vehicleSpecifications" />
    <result column="vehicle_remark" jdbcType="VARCHAR" property="vehicleRemark" />
    <result column="vehicle_vin" jdbcType="VARCHAR" property="vehicleVin" />
    <result column="vehicle_engine_number" jdbcType="VARCHAR" property="vehicleEngineNumber" />
    <result column="chassis_number" jdbcType="VARCHAR" property="chassisNumber" />
    <result column="vehicle_axle_number" jdbcType="VARCHAR" property="vehicleAxleNumber" />
    <result column="vehicle_wheelbase" jdbcType="VARCHAR" property="vehicleWheelbase" />
    <result column="vehicle_tyre_amount" jdbcType="VARCHAR" property="vehicleTyreAmount" />
    <result column="energy_type" jdbcType="VARCHAR" property="energyType" />
    <result column="swept_volume" jdbcType="VARCHAR" property="sweptVolume" />
    <result column="vehicle_color" jdbcType="VARCHAR" property="vehicleColor" />
    <result column="vehicle_factory_date" jdbcType="TIMESTAMP" property="vehicleFactoryDate" />
    <result column="vehicle_buying_date" jdbcType="TIMESTAMP" property="vehicleBuyingDate" />
    <result column="vehicle_annual_date" jdbcType="TIMESTAMP" property="vehicleAnnualDate" />
    <result column="vehicle_two_level_period" jdbcType="TIMESTAMP" property="vehicleTwoLevelPeriod" />
    <result column="vehicle_insurance_company" jdbcType="VARCHAR" property="vehicleInsuranceCompany" />
    <result column="vehicle_policy_num" jdbcType="VARCHAR" property="vehiclePolicyNum" />
    <result column="vehicle_insurance_expiry_date" jdbcType="TIMESTAMP" property="vehicleInsuranceExpiryDate" />
    <result column="vehicle_headerstock_photo" jdbcType="VARCHAR" property="vehicleHeaderstockPhoto" />
    <result column="vehicle_tailstock_photo" jdbcType="VARCHAR" property="vehicleTailstockPhoto" />
    <result column="vehicle_tyre_spec" jdbcType="VARCHAR" property="vehicleTyreSpec" />
    <result column="group_id" jdbcType="BIGINT" property="groupId" />
    <result column="create_id" jdbcType="BIGINT" property="createId" />
    <result column="create_name" jdbcType="VARCHAR" property="createName" />
    <result column="create_date" jdbcType="TIMESTAMP" property="createDate" />
    <result column="update_id" jdbcType="BIGINT" property="updateId" />
    <result column="update_name" jdbcType="VARCHAR" property="updateName" />
    <result column="update_date" jdbcType="TIMESTAMP" property="updateDate" />
    <result column="is_deleted" jdbcType="SMALLINT" property="isDeleted" />
    <result column="company_id" jdbcType="BIGINT" property="companyId" />
  </resultMap>
  <delete id="deleteByPrimaryKey" parameterType="java.lang.Long">
    delete from t_own_vehicle
    where own_vehicle_id = #{ownVehicleId,jdbcType=BIGINT}
  </delete>
  <insert id="insert" parameterType="com.lcdt.traffic.model.OwnVehicle" useGeneratedKeys="true" keyProperty="ownVehicleId">
    insert into t_own_vehicle (affiliated_company, vehicle_num,
      vehicle_trailer_num, vehicle_category, vehicle_type, 
      vehicle_length, vehicle_load, vehicle_driver_phone, 
      vehicle_driver_name, vehicle_brand, vehicle_specifications, 
      vehicle_remark, vehicle_vin, vehicle_engine_number, 
      chassis_number, vehicle_axle_number, vehicle_wheelbase, 
      vehicle_tyre_amount, energy_type, swept_volume, 
      vehicle_color, vehicle_factory_date, vehicle_buying_date, 
      vehicle_annual_date, vehicle_two_level_period, 
      vehicle_insurance_company, vehicle_policy_num, 
      vehicle_insurance_expiry_date, vehicle_headerstock_photo, 
      vehicle_tailstock_photo, vehicle_tyre_spec, 
      group_id, create_id, create_name, 
      create_date, update_id, update_name, 
      update_date, company_id
      )
    values (#{affiliatedCompany,jdbcType=VARCHAR}, #{vehicleNum,jdbcType=VARCHAR},
      #{vehicleTrailerNum,jdbcType=VARCHAR}, #{vehicleCategory,jdbcType=SMALLINT}, #{vehicleType,jdbcType=VARCHAR}, 
      #{vehicleLength,jdbcType=VARCHAR}, #{vehicleLoad,jdbcType=DECIMAL}, #{vehicleDriverPhone,jdbcType=VARCHAR}, 
      #{vehicleDriverName,jdbcType=VARCHAR}, #{vehicleBrand,jdbcType=VARCHAR}, #{vehicleSpecifications,jdbcType=VARCHAR}, 
      #{vehicleRemark,jdbcType=VARCHAR}, #{vehicleVin,jdbcType=VARCHAR}, #{vehicleEngineNumber,jdbcType=VARCHAR}, 
      #{chassisNumber,jdbcType=VARCHAR}, #{vehicleAxleNumber,jdbcType=VARCHAR}, #{vehicleWheelbase,jdbcType=VARCHAR}, 
      #{vehicleTyreAmount,jdbcType=VARCHAR}, #{energyType,jdbcType=VARCHAR}, #{sweptVolume,jdbcType=VARCHAR}, 
      #{vehicleColor,jdbcType=VARCHAR}, #{vehicleFactoryDate,jdbcType=TIMESTAMP}, #{vehicleBuyingDate,jdbcType=TIMESTAMP}, 
      #{vehicleAnnualDate,jdbcType=TIMESTAMP}, #{vehicleTwoLevelPeriod,jdbcType=TIMESTAMP}, 
      #{vehicleInsuranceCompany,jdbcType=VARCHAR}, #{vehiclePolicyNum,jdbcType=VARCHAR}, 
      #{vehicleInsuranceExpiryDate,jdbcType=TIMESTAMP}, #{vehicleHeaderstockPhoto,jdbcType=VARCHAR}, 
      #{vehicleTailstockPhoto,jdbcType=VARCHAR}, #{vehicleTyreSpec,jdbcType=VARCHAR}, 
      #{groupId,jdbcType=BIGINT}, #{createId,jdbcType=BIGINT}, #{createName,jdbcType=VARCHAR}, 
      CURRENT_TIMESTAMP , #{updateId,jdbcType=BIGINT}, #{updateName,jdbcType=VARCHAR},
      #{updateDate,jdbcType=TIMESTAMP}, #{companyId,jdbcType=BIGINT}
      )
  </insert>
  <update id="updateByPrimaryKey" parameterType="com.lcdt.traffic.model.OwnVehicle">
    update t_own_vehicle
    set affiliated_company = #{affiliatedCompany,jdbcType=VARCHAR},
      vehicle_num = #{vehicleNum,jdbcType=VARCHAR},
      vehicle_trailer_num = #{vehicleTrailerNum,jdbcType=VARCHAR},
      vehicle_category = #{vehicleCategory,jdbcType=SMALLINT},
      vehicle_type = #{vehicleType,jdbcType=VARCHAR},
      vehicle_length = #{vehicleLength,jdbcType=VARCHAR},
      vehicle_load = #{vehicleLoad,jdbcType=DECIMAL},
      vehicle_driver_phone = #{vehicleDriverPhone,jdbcType=VARCHAR},
      vehicle_driver_name = #{vehicleDriverName,jdbcType=VARCHAR},
      vehicle_brand = #{vehicleBrand,jdbcType=VARCHAR},
      vehicle_specifications = #{vehicleSpecifications,jdbcType=VARCHAR},
      vehicle_remark = #{vehicleRemark,jdbcType=VARCHAR},
      vehicle_vin = #{vehicleVin,jdbcType=VARCHAR},
      vehicle_engine_number = #{vehicleEngineNumber,jdbcType=VARCHAR},
      chassis_number = #{chassisNumber,jdbcType=VARCHAR},
      vehicle_axle_number = #{vehicleAxleNumber,jdbcType=VARCHAR},
      vehicle_wheelbase = #{vehicleWheelbase,jdbcType=VARCHAR},
      vehicle_tyre_amount = #{vehicleTyreAmount,jdbcType=VARCHAR},
      energy_type = #{energyType,jdbcType=VARCHAR},
      swept_volume = #{sweptVolume,jdbcType=VARCHAR},
      vehicle_color = #{vehicleColor,jdbcType=VARCHAR},
      vehicle_factory_date = #{vehicleFactoryDate,jdbcType=TIMESTAMP},
      vehicle_buying_date = #{vehicleBuyingDate,jdbcType=TIMESTAMP},
      vehicle_annual_date = #{vehicleAnnualDate,jdbcType=TIMESTAMP},
      vehicle_two_level_period = #{vehicleTwoLevelPeriod,jdbcType=TIMESTAMP},
      vehicle_insurance_company = #{vehicleInsuranceCompany,jdbcType=VARCHAR},
      vehicle_policy_num = #{vehiclePolicyNum,jdbcType=VARCHAR},
      vehicle_insurance_expiry_date = #{vehicleInsuranceExpiryDate,jdbcType=TIMESTAMP},
      vehicle_headerstock_photo = #{vehicleHeaderstockPhoto,jdbcType=VARCHAR},
      vehicle_tailstock_photo = #{vehicleTailstockPhoto,jdbcType=VARCHAR},
      vehicle_tyre_spec = #{vehicleTyreSpec,jdbcType=VARCHAR},
      group_id = #{groupId,jdbcType=BIGINT},
      update_id = #{updateId,jdbcType=BIGINT},
      update_name = #{updateName,jdbcType=VARCHAR},
      update_date = CURRENT_TIMESTAMP
    where own_vehicle_id = #{ownVehicleId,jdbcType=BIGINT} and company_id = #{companyId,jdbcType=BIGINT}
  </update>
  <select id="selectByPrimaryKey" parameterType="java.lang.Long" resultMap="BaseResultMap">
    select own_vehicle_id, affiliated_company, vehicle_num, vehicle_trailer_num, vehicle_category, 
    vehicle_type, vehicle_length, vehicle_load, vehicle_driver_phone, vehicle_driver_name, 
    vehicle_brand, vehicle_specifications, vehicle_remark, vehicle_vin, vehicle_engine_number, 
    chassis_number, vehicle_axle_number, vehicle_wheelbase, vehicle_tyre_amount, energy_type, 
    swept_volume, vehicle_color, vehicle_factory_date, vehicle_buying_date, vehicle_annual_date, 
    vehicle_two_level_period, vehicle_insurance_company, vehicle_policy_num, vehicle_insurance_expiry_date, 
    vehicle_headerstock_photo, vehicle_tailstock_photo, vehicle_tyre_spec, group_id, 
    create_id, create_name, create_date, update_id, update_name, update_date, is_deleted, 
    company_id
    from t_own_vehicle
    where own_vehicle_id = #{ownVehicleId,jdbcType=BIGINT}
  </select>
  <select id="selectAll" resultMap="BaseResultMap">
    select own_vehicle_id, affiliated_company, vehicle_num, vehicle_trailer_num, vehicle_category, 
    vehicle_type, vehicle_length, vehicle_load, vehicle_driver_phone, vehicle_driver_name, 
    vehicle_brand, vehicle_specifications, vehicle_remark, vehicle_vin, vehicle_engine_number, 
    chassis_number, vehicle_axle_number, vehicle_wheelbase, vehicle_tyre_amount, energy_type, 
    swept_volume, vehicle_color, vehicle_factory_date, vehicle_buying_date, vehicle_annual_date, 
    vehicle_two_level_period, vehicle_insurance_company, vehicle_policy_num, vehicle_insurance_expiry_date, 
    vehicle_headerstock_photo, vehicle_tailstock_photo, vehicle_tyre_spec, group_id, 
    create_id, create_name, create_date, update_id, update_name, update_date, is_deleted, 
    company_id
    from t_own_vehicle
  </select>


  <!-- ——————————————————————————————————————————华丽分割线—————————————————————————————————————————————— -->


  <resultMap id="ResultMapDto" type="com.lcdt.traffic.web.dto.OwnVehicleDto">
    <id column="own_vehicle_id" jdbcType="BIGINT" property="ownVehicleId" />
    <result column="affiliated_company" jdbcType="VARCHAR" property="affiliatedCompany" />
    <result column="vehicle_num" jdbcType="VARCHAR" property="vehicleNum" />
    <result column="vehicle_trailer_num" jdbcType="VARCHAR" property="vehicleTrailerNum" />
    <result column="vehicle_category" jdbcType="SMALLINT" property="vehicleCategory" />
    <result column="vehicle_type" jdbcType="VARCHAR" property="vehicleType" />
    <result column="vehicle_length" jdbcType="VARCHAR" property="vehicleLength" />
    <result column="vehicle_load" jdbcType="DECIMAL" property="vehicleLoad" />
    <result column="vehicle_driver_phone" jdbcType="VARCHAR" property="vehicleDriverPhone" />
    <result column="vehicle_driver_name" jdbcType="VARCHAR" property="vehicleDriverName" />
    <result column="vehicle_brand" jdbcType="VARCHAR" property="vehicleBrand" />
    <result column="vehicle_specifications" jdbcType="VARCHAR" property="vehicleSpecifications" />
    <result column="vehicle_remark" jdbcType="VARCHAR" property="vehicleRemark" />
    <result column="vehicle_vin" jdbcType="VARCHAR" property="vehicleVin" />
    <result column="vehicle_engine_number" jdbcType="VARCHAR" property="vehicleEngineNumber" />
    <result column="chassis_number" jdbcType="VARCHAR" property="chassisNumber" />
    <result column="vehicle_axle_number" jdbcType="VARCHAR" property="vehicleAxleNumber" />
    <result column="vehicle_wheelbase" jdbcType="VARCHAR" property="vehicleWheelbase" />
    <result column="vehicle_tyre_amount" jdbcType="VARCHAR" property="vehicleTyreAmount" />
    <result column="energy_type" jdbcType="VARCHAR" property="energyType" />
    <result column="swept_volume" jdbcType="VARCHAR" property="sweptVolume" />
    <result column="vehicle_color" jdbcType="VARCHAR" property="vehicleColor" />
    <result column="vehicle_factory_date" jdbcType="TIMESTAMP" property="vehicleFactoryDate" />
    <result column="vehicle_buying_date" jdbcType="TIMESTAMP" property="vehicleBuyingDate" />
    <result column="vehicle_annual_date" jdbcType="TIMESTAMP" property="vehicleAnnualDate" />
    <result column="vehicle_two_level_period" jdbcType="TIMESTAMP" property="vehicleTwoLevelPeriod" />
    <result column="vehicle_insurance_company" jdbcType="VARCHAR" property="vehicleInsuranceCompany" />
    <result column="vehicle_policy_num" jdbcType="VARCHAR" property="vehiclePolicyNum" />
    <result column="vehicle_insurance_expiry_date" jdbcType="TIMESTAMP" property="vehicleInsuranceExpiryDate" />
    <result column="vehicle_headerstock_photo" jdbcType="VARCHAR" property="vehicleHeaderstockPhoto" />
    <result column="vehicle_tailstock_photo" jdbcType="VARCHAR" property="vehicleTailstockPhoto" />
    <result column="vehicle_tyre_spec" jdbcType="VARCHAR" property="vehicleTyreSpec" />
    <result column="group_id" jdbcType="BIGINT" property="groupId" />
    <result column="create_id" jdbcType="BIGINT" property="createId" />
    <result column="create_name" jdbcType="VARCHAR" property="createName" />
    <result column="create_date" jdbcType="TIMESTAMP" property="createDate" />
    <result column="update_id" jdbcType="BIGINT" property="updateId" />
    <result column="update_name" jdbcType="VARCHAR" property="updateName" />
    <result column="update_date" jdbcType="TIMESTAMP" property="updateDate" />
    <result column="is_deleted" jdbcType="SMALLINT" property="isDeleted" />
    <result column="company_id" jdbcType="BIGINT" property="companyId" />
    <collection property="ownVehicleCertificateList" column="own_vehicle_id" ofType="com.lcdt.traffic.model.OwnVehicleCertificate">
    </collection>
  </resultMap>

  <select id="selectVehicleNum" resultType="java.lang.Integer">
    select count(own_vehicle_id)
    from t_own_vehicle
    where vehicle_num = #{0}
  </select>
  <update id="deleteByUpdate" parameterType="com.lcdt.traffic.model.OwnVehicle">
    update t_own_vehicle
    set is_deleted = 1,
      update_id = #{updateId,jdbcType=BIGINT},
      update_name = #{updateName,jdbcType=VARCHAR},
      update_date = CURRENT_TIMESTAMP
    where own_vehicle_id = #{ownVehicleId,jdbcType=BIGINT} and company_id = #{companyId,jdbcType=BIGINT}
  </update>
  <select id="selectByCondition" parameterType="com.lcdt.traffic.model.OwnVehicle" resultMap="BaseResultMap">
    select own_vehicle_id, affiliated_company, vehicle_num, vehicle_trailer_num, vehicle_category,
    vehicle_type, vehicle_length, vehicle_load, vehicle_driver_phone, vehicle_driver_name,
    vehicle_brand, vehicle_specifications, vehicle_remark, vehicle_vin, vehicle_engine_number,
    chassis_number, vehicle_axle_number, vehicle_wheelbase, vehicle_tyre_amount, energy_type,
    swept_volume, vehicle_color, vehicle_factory_date, vehicle_buying_date, vehicle_annual_date,
    vehicle_two_level_period, vehicle_insurance_company, vehicle_policy_num, vehicle_insurance_expiry_date,
    vehicle_headerstock_photo, vehicle_tailstock_photo, vehicle_tyre_spec, group_id,
    create_id, create_name, create_date, update_id, update_name, update_date, is_deleted,
    company_id
    from t_own_vehicle
    <where>
      company_id = #{companyId,jdbcType=BIGINT}
      <if test="affiliatedCompany!=null and affiliatedCompany!=''">
        and affiliated_company like '%#{affiliatedCompany,jdbcType=VARCHAR}%'
      </if>
      <if test="vehicleNum!=null and vehicleNum!=''">
        and vehicle_num like '%#{vehicleNum,jdbcType=VARCHAR}%'
      </if>
      <if test="vehicleDriverName!=null and vehicleDriverName!=''">
        and (vehicle_driver_name like '%#{vehicleDriverName,jdbcType=VARCHAR}%' or vehicle_driver_phone like '%#{vehicleDriverName,jdbcType=VARCHAR}%')
      </if>
      <if test="vehicleCategory==0 or vehicleCategory==1">
        and vehicle_category = #{vehicleCategory,jdbcType=VARCHAR}
      </if>
    </where>
  </select>
  <select id="selectDetail" resultMap="ResultMapDto">
    select t1.own_vehicle_id, t1.affiliated_company, t1.vehicle_num, t1.vehicle_trailer_num, t1.vehicle_category,
    t1.vehicle_type, t1.vehicle_length, t1.vehicle_load, t1.vehicle_driver_phone, t1.vehicle_driver_name,
    t1.vehicle_brand, t1.vehicle_specifications, t1.vehicle_remark, t1.vehicle_vin, t1.vehicle_engine_number,
    t1.chassis_number, t1.vehicle_axle_number, t1.vehicle_wheelbase, t1.vehicle_tyre_amount, t1.energy_type,
    t1.swept_volume, t1.vehicle_color, t1.vehicle_factory_date, t1.vehicle_buying_date, t1.vehicle_annual_date,
    t1.vehicle_two_level_period, t1.vehicle_insurance_company, t1.vehicle_policy_num, t1.vehicle_insurance_expiry_date,
    t1.vehicle_headerstock_photo, t1.vehicle_tailstock_photo, t1.vehicle_tyre_spec, t1.group_id,t1.company_id,
    t2.ovc_id, t2.own_vehicle_id, t2.group_name, t2.certificate_type,certificate_no, t2.process_dt, t2.certificate_validity_begin,
    t2.certificate_validity_end, t2.certificate_fee, t2.certificate_attachment1, t2.certificate_attachment2,
    t2.certificate_attachment3, t2.group_remark
    from t_own_vehicle t1 left join t_own_vehicle_certificate t2 on t1.own_vehicle_id = t2.own_vehicle_id
    where t1.own_vehicle_id = #{0} and company_id = #{1}
  </select>
</mapper>