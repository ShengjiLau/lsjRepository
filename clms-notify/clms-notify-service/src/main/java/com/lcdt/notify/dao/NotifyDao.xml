<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.lcdt.notify.dao.NotifyDao">

  <select id="queryByEventName" resultMap="com.lcdt.notify.dao.NotifyMapper.BaseResultMap">

    select notify_id, receive_role, template_id, notify_name, event_name,category
    from notify
    where event_name = #{eventName,jdbcType=VARCHAR}

  </select>
    
   <select id="queryByTemplateId" resultMap="com.lcdt.notify.dao.CustomeNotifyContentMapper.BaseResultMap">
    select custome_id, company_id, template_id, content, create_time, update_time
    from custome_notify_content
    where template_id = #{templateId}
    and company_id = #{companyId}
   </select>

    <resultMap id="NotifySetDto" type="com.lcdt.notify.web.dto.NotifySetDto">
        <id column="notify_id" jdbcType="BIGINT" property="notifyId" />
        <result column="template_content" jdbcType="VARCHAR" property="templateContent" />
        <result column="template_create_time" jdbcType="TIMESTAMP" property="templateCreateTime" />
        <result column="template_parser_context_class" jdbcType="VARCHAR" property="templateParserContextClass" />
        <result column="template_event_name" jdbcType="VARCHAR" property="templateEventName" />
        <result column="template_name" jdbcType="VARCHAR" property="templateName" />
        <result column="template_id" jdbcType="BIGINT" property="templateId" />
        <result column="default_enable_web" jdbcType="BIT" property="defaultEnableWeb" />
        <result column="default_enable_sms" jdbcType="BIT" property="defaultEnableSms" />
        <result column="content" jdbcType="VARCHAR" property="content" />
        <result column="enable_sms" jdbcType="BIT" property="enableSms" />
        <result column="enable_web" jdbcType="BIT" property="enableWeb" />
        <result column="receive_role" jdbcType="VARCHAR" property="receiveRole" />

        <result column="event_name" jdbcType="VARCHAR" property="eventName" />
        <result column="event_display_name" jdbcType="VARCHAR" property="eventShowName" />
        <result column="event_module_name" jdbcType="VARCHAR" property="eventModuleName" />
    </resultMap>

    <select id="selectNotifySetByCateGory" resultMap="NotifySetDto">
SELECT *
from notify n
left join event_meta ev
on n.event_name = ev.event_name

left join msg_template t
  on t.template_id = n.template_id
LEFT JOIN custome_notify_content c
  on c.template_id = n.template_id
  and c.company_id = #{companyId}
LEFT JOIN  company_notify_setting s
  on s.notify_id = n.notify_id
  and s.company_id = #{companyId}
  <if test="category != null and category != ''">
      WHERE category = #{category,jdbcType=VARCHAR}
  </if>
        order by t.template_id ,n.notify_id
    </select>
</mapper>